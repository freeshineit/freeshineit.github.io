import MDXContentCom from "@shared/MDXContent";
import { RandomCover } from "@constant";
export const meta = {
  title: "tapable ç®€å•ä½¿ç”¨éšç¬”",
  description:
    "The tapable package expose many Hook classes, which can be used to create hooks for plugins.tapable æ˜¯ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å¼çš„å®ç°ï¼Œå®ƒæä¾›äº†å¾ˆå¤šåº”å¯¹ä¸šåŠ¡çš„ hooks å®ç°å’ŒæŠ½è±¡ã€‚ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»åŒæ­¥å’Œå¼‚æ­¥ã€‚",
  // tapable ç®€å•ä½¿ç”¨éšç¬”, webpack tapable , SyncHook,SyncBailHook, SyncLoopHook, SyncWaterfallHook, AsyncSeriesHook, AsyncSeriesBailHook, AsyncSeriesLoopHook,AsyncSeriesWaterfallHook, AsyncParallelHook, AsyncParallelBailHook ",
  date: "2022-11-28",
  cover: "/static/images/webpack.png"
};

export default ({ children }) => (
  <MDXContentCom meta={meta}>{children}</MDXContentCom>
);

## tapable

The [tapable](https://github.com/webpack/tapable) package expose many Hook classes, which can be used to create hooks for plugins.

`tapable` æ˜¯ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å¼çš„å®ç°ï¼Œå®ƒæä¾›äº†å¾ˆå¤šåº”å¯¹ä¸šåŠ¡çš„ `hooks` å®ç°å’ŒæŠ½è±¡ã€‚ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»åŒæ­¥å’Œå¼‚æ­¥ã€‚

## Base Hooks

- [Hooks](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/Hook.js?L25:1)

ç»§æ‰¿ `Hooks` çš„ç±»éœ€è¦è‡ªå·±å®ç°`compile`æŠ½è±¡æ–¹æ³•ã€‚

- [HookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1)

ç»§æ‰¿`HookCodeFactory`ç±»éœ€è¦å®ç°æŠ½è±¡æ–¹æ³•`content`, è¿”å› `call`æˆ–`callAsync`æˆ–`promise` çš„å‡½æ•°ä½“çš„å®ç°çš„ä»£ç å­—ç¬¦ä¸²ï¼Œ ç„¶åä½¿ç”¨ `Function` ç”Ÿæˆä¸€ä¸ª`call`æˆ–`callAsync`æˆ–`promise` å‡½æ•°

## SyncHook

[SyncHook](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncHook.js?L35:1) æŒ‰æ³¨å†Œçš„å›è°ƒå‡½æ•°ä¸²è¡Œä¹‹è¡Œã€‚

ç®€å•ä½¿ç”¨ï¼š

```js
const { SyncHook } = require("tapable");
// ç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ– Hooks ç±»
// æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°åçš„å­—ç¬¦ä¸²æ•°ç»„
// è¿™ç»„å‚æ•°å’Œæ³¨å†Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰å…³ï¼Œ
const hook = new SyncHook(["arg1", "arg2", "arg3"]);
// æ³¨å†Œ
// ç¬¬ä¸€ä¸ªå…¥å‚ä¸ºæ³¨å†Œå
// ç¬¬äºŒä¸ªä¸ºæ³¨å†Œå›è°ƒæ–¹æ³•ï¼Œå‚æ•°çš„å½¢å‚ä¸ªæ•°å’Œ`SyncHook`çš„å…¥å‚çš„æ•°ç»„æœ‰å…³ç³»
hook.tap("fn0", (arg1, arg2, arg3) => {
  console.log(1, arg1, arg2, arg3);
  return "fn0"; // å›è°ƒå‡½æ•°çš„è¿”å›å€¼ä¹‹é—´æ²¡æœ‰è”ç³»
});
hook.tap("fn1", (arg1, arg2, arg3) => {
  console.log(2, arg1, arg2, arg3);
  return "fn1";
});
hook.tap("fn2", (arg1, arg2, arg3) => {
  console.log(3, arg1, arg2, arg3);
  return "fn2";
});
// æ‰§è¡Œ
// æ‰§è¡Œé¡ºåºåˆ™æ˜¯æ ¹æ®è¿™ä¸ªå®ä¾‹ç±»å‹æ¥å†³å®šçš„
hook.call("a", "b", "c");
```

`call`ç”±[SyncHookCodeFactory](https://sourcegraph.com/search?q=context:global+repo:%5Egithub%5C.com/webpack/tapable%24+SyncHookCodeFactory&patternType=standard&sm=1)çš„`content`å®ç°, ç»“æœå¦‚ä¸‹ï¼š

```js
// è¿™æ˜¯ä¸€æ®µ`call`æ–¹æ³•å®ç°çš„ä»£ç å­—ç¬¦ä¸²
// è¿™æ®µä»£ç éœ€è¦ä½¿ç”¨ `Function` æ¥ç”Ÿæˆ`call`æ–¹æ³•æ¥æ‰§è¡Œ
// å…¶ä¸­`this._x`å°±æ˜¯æ³¨å†Œçš„å›è°ƒå‡½æ•°ç»„æˆçš„æ•°ç»„
// å¯ä»¥çœ‹å‡ºå›è°ƒå‡½æ•°çš„è°ƒç”¨å°±æ˜¯æŠŠæ•°ç»„ä¸­çš„å‡½æ•°å±•å¼€
"use strict";
var _context;
var _x = this._x;
var _fn0 = _x[0];
_fn0(arg3, arg2, arg1); // å›è°ƒå‡½æ•° fn0
var _fn1 = _x[1];
_fn1(arg3, arg2, arg1); // å›è°ƒå‡½æ•° fn1
var _fn2 = _x[2];
_fn2(arg3, arg2, arg1); // å›è°ƒå‡½æ•° fn2
```

## SyncBailHook

[SyncBailHook](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncBailHook.js?L40:1) ä¼šå¯¹æ¯æ¬¡æ‰§è¡Œçš„ç»“æœè¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœç»“æœä¸æ˜¯ `undefined` å°±ç›´æ¥ `return` äº†ï¼Œåé¢çš„å›è°ƒå‡½æ•°å°±æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†ã€‚

ç®€å•ä½¿ç”¨ï¼š

```js
const { SyncBailHook } = require("tapable");
// ç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ– Hooks ç±»
// æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°åçš„å­—ç¬¦ä¸²æ•°ç»„
// è¿™ç»„å‚æ•°å’Œæ³¨å†Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰å…³ï¼Œ
// åŒæ­¥æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°è¿”å›ç»“æœä¸æ˜¯ `undefined` å°±ç›´æ¥ `return` äº†ï¼Œåé¢çš„å›è°ƒå‡½æ•°å°±æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†
const hook = new SyncBailHook(["arg1", "arg2", "arg3"]);
// æ³¨å†Œ
// ç¬¬ä¸€ä¸ªå…¥å‚ä¸ºæ³¨å†Œå
// ç¬¬äºŒä¸ªä¸ºæ³¨å†Œå›è°ƒæ–¹æ³•ï¼Œå‚æ•°çš„å½¢å‚ä¸ªæ•°å’Œ`SyncBailHook`çš„å…¥å‚çš„æ•°ç»„æœ‰å…³ç³»
hook.tap("fn0", (arg1, arg2, arg3) => {
  console.log("fn0", arg1, arg2, arg3);
  return undefined;
});
hook.tap("fn1", (arg1, arg2, arg3) => {
  console.log("fn1", arg1, arg2, arg3);
  // å¦‚æœå›è°ƒå‡½æ•°çš„è¿”å›ç»“æœä¸æ˜¯ `undefined` å°±ç›´æ¥ `return` äº†ï¼Œåé¢çš„å›è°ƒå‡½æ•°å°±æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†
  return "fn1";
});
hook.tap("fn2", (arg1, arg2, arg3) => {
  console.log("fn2", arg1, arg2, arg3);
  return undefined;
});
// æ‰§è¡Œ
// æ‰§è¡Œé¡ºåºåˆ™æ˜¯æ ¹æ®è¿™ä¸ªå®ä¾‹ç±»å‹æ¥å†³å®šçš„
hook.call("a", "b", "c");
```

`call`ç”±`SyncBailHookCodeFactory`çš„`content`å®ç°, ç»“æœå¦‚ä¸‹ï¼š

```js
// è¿™æ˜¯ä¸€æ®µ`call`æ–¹æ³•å®ç°çš„ä»£ç å­—ç¬¦ä¸²
// å‚æ•°å’ŒSyncHookæ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«åœ¨äºå›è°ƒå‡½æ•°çš„è¿”å›å€¼
// å¦‚æœå›è°ƒå‡½æ•°çš„è¿”å›ç»“æœä¸æ˜¯ `undefined` å°±ç›´æ¥ `return` äº†ï¼Œåé¢çš„å›è°ƒå‡½æ•°å°±æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†ã€‚
// å°±åƒä¸€ä¸ªæœ‰é™çš„å¥—å¨ƒğŸª†
"use strict";
var _context;
var _x = this._x;
var _fn0 = _x[0];
var _result0 = _fn0(arg3, arg2, arg1);
// å¦‚æœè¿”å›ç»“æœä¸æ˜¯ `undefined` å°±ç›´æ¥ `return` äº†ï¼Œåé¢çš„å›è°ƒå‡½æ•°å°±æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†ã€‚
if (_result0 !== undefined) {
  return _result0;
} else {
  var _fn1 = _x[1];
  var _result1 = _fn1(arg3, arg2, arg1);
  // å¦‚æœè¿”å›ç»“æœä¸æ˜¯ `undefined` å°±ç›´æ¥ `return` äº†ï¼Œåé¢çš„å›è°ƒå‡½æ•°å°±æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†ã€‚
  if (_result1 !== undefined) {
    return _result1;
  } else {
    var _fn2 = _x[2];
    var _result2 = _fn2(arg3, arg2, arg1);
    // å¦‚æœè¿”å›ç»“æœä¸æ˜¯ `undefined` å°±ç›´æ¥ `return` äº†ï¼Œåé¢çš„å›è°ƒå‡½æ•°å°±æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†ã€‚
    if (_result2 !== undefined) {
      return _result2;
    } else {
    }
  }
}
```

## SyncLoopHook

[SyncLoopHook](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncLoopHook.js?L35:1) ä¼šå¯¹æ¯æ¬¡æ‰§è¡Œçš„ç»“æœè¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœç»“æœä¸æ˜¯ `undefined` å°±ä¸åœå¾ªç¯ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°åˆ°å½“å‰å›è°ƒå‡½æ•°ï¼Œç›´è‡³éƒ½è¿”å› `undefined`ã€‚

ç®€å•ä½¿ç”¨ï¼š

```js
const { SyncLoopHook } = require("tapable");
// ç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ– Hooks ç±»
// æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°åçš„å­—ç¬¦ä¸²æ•°ç»„
// è¿™ç»„å‚æ•°å’Œæ³¨å†Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰å…³ï¼Œ
const hook = new SyncLoopHook(["arg1", "arg2", "arg3"]);
let _loop = 4;

// æ³¨å†Œ
// ç¬¬ä¸€ä¸ªå…¥å‚ä¸ºæ³¨å†Œå
// ç¬¬äºŒä¸ªä¸ºæ³¨å†Œå›è°ƒæ–¹æ³•ï¼Œå‚æ•°çš„å½¢å‚ä¸ªæ•°å’Œ`SyncLoopHook`çš„å…¥å‚çš„æ•°ç»„æœ‰å…³ç³»
hook.tap("fn0", (arg1, arg2, arg3) => {
  console.log("fn0", arg1, arg2, arg3);
  return undefined;
});
hook.tap("fn1", (arg1, arg2, arg3) => {
  console.log("fn1", arg1, arg2, arg3);
  _loop = _loop - 1;
  // å¦‚æœè¿”å›ç»“æœä¸æ˜¯ `undefined` å°±ä¸åœå¾ªç¯ `f0` `f1`ï¼Œç›´è‡³éƒ½è¿”å› `undefined`ã€‚
  return _loop > 0 ? _loop : undefined;
});
hook.tap("fn2", (arg1, arg2, arg3) => {
  console.log("fn2", arg1, arg2, arg3);
  return undefined;
});
// æ‰§è¡Œ
// æ‰§è¡Œé¡ºåºåˆ™æ˜¯æ ¹æ®è¿™ä¸ªå®ä¾‹ç±»å‹æ¥å†³å®šçš„
hook.call("a", "b", "c");
```

`call`ç”±[SyncLoopHookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncLoopHook.js?L10:1)çš„`content`å®ç°, ç»“æœå¦‚ä¸‹ï¼š

```js
// è¿™æ˜¯ä¸€æ®µ`call`æ–¹æ³•å®ç°çš„ä»£ç å­—ç¬¦ä¸²
// å‚æ•°å’ŒSyncHookæ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«åœ¨äºå›è°ƒå‡½æ•°çš„è¿”å›å€¼
// å¦‚æœç»“æœä¸æ˜¯ `undefined` å°±ä¸åœå¾ªç¯ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°åˆ°å½“å‰å›è°ƒå‡½æ•°ï¼Œç›´è‡³éƒ½è¿”å› `undefined`
// æ³¨æ„: ä¸è¿”å›`undefined`å°±ä¸åœå¾ªç¯ï¼Œå®¹æ˜“é€ æˆæ­»å¾ªç¯
"use strict";
var _context;
var _x = this._x;
var _loop;
do {
  _loop = false;
  var _fn0 = _x[0];
  var _result0 = _fn0(arg3, arg2, arg1);
  if (_result0 !== undefined) {
    _loop = true;
  } else {
    var _fn1 = _x[1];
    var _result1 = _fn1(arg3, arg2, arg1);
    if (_result1 !== undefined) {
      _loop = true;
    } else {
      var _fn2 = _x[2];
      var _result2 = _fn2(arg3, arg2, arg1);
      if (_result2 !== undefined) {
        _loop = true;
      } else {
        if (!_loop) {
        }
      }
    }
  }
} while (_loop);
```

## SyncWaterfallHook

[SyncWaterfallHook](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncWaterfallHook.js?L44) ä¼šå¯¹æ¯æ¬¡æ‰§è¡Œçš„ç»“æœå½“æˆä¸‹ä¸€ä¸ªå›è°ƒå‡½æ•°çš„å…¥å‚ï¼ˆ`call`çš„å…¥å‚ ï¼‰ï¼Œå¦‚æœè¿”å›å€¼æ˜¯ `undefined`ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå‚æ•°ã€‚

ç®€å•ä½¿ç”¨ï¼š

```js
const { SyncWaterfallHook } = require("tapable");
// ç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ– Hooks ç±»
// æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°åçš„å­—ç¬¦ä¸²æ•°ç»„
// è¿™ç»„å‚æ•°å’Œæ³¨å†Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰å…³ï¼Œ
const hook = new SyncWaterfallHook(["arg1", "arg2", "arg3"]);

// æ³¨å†Œ
// ç¬¬ä¸€ä¸ªå…¥å‚ä¸ºæ³¨å†Œå
// ç¬¬äºŒä¸ªä¸ºæ³¨å†Œå›è°ƒæ–¹æ³•ï¼Œå‚æ•°çš„å½¢å‚ä¸ªæ•°å’Œ`SyncWaterfallHook`çš„å…¥å‚çš„æ•°ç»„æœ‰å…³ç³»
hook.tap("fn0", (arg1, arg2, arg3) => {
  console.log("fn0", arg1, arg2, arg3);
  return "fn0-result";
});
hook.tap("fn1", (arg1, arg2, arg3) => {
  console.log("fn1", arg1, arg2, arg3);
  return undefined;
});
hook.tap("fn2", (arg1, arg2, arg3) => {
  console.log("fn2", arg1, arg2, arg3);
  return "fn2";
});
hook.tap("fn3", (arg1, arg2, arg3) => {
  console.log("fn3", arg1, arg2, arg3);
  return "fn3";
});
// æ‰§è¡Œ
// æ‰§è¡Œé¡ºåºåˆ™æ˜¯æ ¹æ®è¿™ä¸ªå®ä¾‹ç±»å‹æ¥å†³å®šçš„
hook.call("a", "b", "c");
// æ‰§è¡Œç»“æœï¼š
// fn0 a b c
// fn1 fn0-result b c
// fn2 fn0-result b c
// fn3 fn2 b c
```

`call`ç”±[SyncWaterfallHookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncWaterfallHook.js?L10:7)çš„`content`å®ç°, ç»“æœå¦‚ä¸‹ï¼š

```js
// è¿™æ˜¯ä¸€æ®µ`call`æ–¹æ³•å®ç°çš„ä»£ç å­—ç¬¦ä¸²
// å‚æ•°å’ŒSyncHookæ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«åœ¨äºå›è°ƒå‡½æ•°çš„è¿”å›å€¼
// å¦‚æœè¿”å›å€¼æ˜¯ `undefined` , ä½¿ç”¨`call`çš„å‚æ•°ï¼Œå¦åˆ™ä½¿ç”¨è¿”å›çš„å€¼
"use strict";
var _context;
var _x = this._x;
var _fn0 = _x[0];
var _result0 = _fn0(arg1, arg2, arg3);
if (_result0 !== undefined) {
  // å¦‚æœè¿”å›å€¼æ˜¯ `undefined` , ä½¿ç”¨`call`çš„å‚æ•°ï¼Œå¦åˆ™ä½¿ç”¨è¿”å›çš„å€¼
  arg1 = _result0;
}
var _fn1 = _x[1];
var _result1 = _fn1(arg1, arg2, arg3);
if (_result1 !== undefined) {
  // å¦‚æœè¿”å›å€¼æ˜¯ `undefined` , ä½¿ç”¨`call`çš„å‚æ•°ï¼Œå¦åˆ™ä½¿ç”¨è¿”å›çš„å€¼
  arg1 = _result1;
}
var _fn2 = _x[2];
var _result2 = _fn2(arg1, arg2, arg3);
if (_result2 !== undefined) {
  // å¦‚æœè¿”å›å€¼æ˜¯ `undefined` , ä½¿ç”¨`call`çš„å‚æ•°ï¼Œå¦åˆ™ä½¿ç”¨è¿”å›çš„å€¼
  arg1 = _result2;
}
var _fn3 = _x[3];
var _result3 = _fn3(arg1, arg2, arg3);
if (_result3 !== undefined) {
  arg1 = _result3;
}
return arg1;
```

## AsyncSeriesHook

[AsyncSeriesHook](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesHook.js?L26:1)å¼‚æ­¥ä¸²è¡Œ

```js
const { AsyncSeriesHook } = require("tapable");
// ç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ– Hooks ç±»
// æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°åçš„å­—ç¬¦ä¸²æ•°ç»„
// è¿™ç»„å‚æ•°å’Œæ³¨å†Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰å…³ï¼Œ
const hook = new AsyncSeriesHook(["arg1", "arg2", "arg3"]);

// æ³¨å†Œ
// ç¬¬ä¸€ä¸ªå…¥å‚ä¸ºæ³¨å†Œå
// ç¬¬äºŒä¸ªä¸ºæ³¨å†Œå›è°ƒæ–¹æ³•ï¼Œå‚æ•°çš„å½¢å‚ä¸ªæ•°å’Œ`AsyncSeriesHook`çš„å…¥å‚çš„æ•°ç»„æœ‰å…³ç³»
hook.tapAsync("fn0", (arg1, arg2, arg3, callback) => {
  setTimeout(() => {
    console.log("fn0", arg1, arg2, arg3);
    callback();
  }, 1000);
});
hook.tapAsync("fn1", (arg1, arg2, arg3, callback) => {
  setTimeout(() => {
    console.log("fn1", arg1, arg2, arg3);
    callback();
  }, 1000);
});
hook.tapAsync("fn2", (arg1, arg2, arg3, callback) => {
  setTimeout(() => {
    console.log("fn2", arg1, arg2, arg3);
    callback(); // å†³å®š `callAsync` æœ€åçš„å®å‚callbackæ˜¯å¦ä¼šè¢«è°ƒç”¨
  }, 1000);
});
// æ‰§è¡Œ
// æ‰§è¡Œé¡ºåºåˆ™æ˜¯æ ¹æ®è¿™ä¸ªå®ä¾‹ç±»å‹æ¥å†³å®šçš„
hook.callAsync("a", "b", "c", () => {
  console.log("AsyncSeriesHook async");
});

// æ‰§è¡Œç»“æœï¼š
// fn0 a b c
// fn1 a b c
// fn2 a b c
// AsyncSeriesHook async
```

`callAsync` ç”±[AsyncSeriesHookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesHook.js?L10:1)çš„`content`å®ç°, æ›´æ·±å±‚æ¬¡æ¥è¯´åº”è¯¥æ˜¯ç”±[HookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1)çš„[callTapsSeries](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L276)å®ç°ã€‚ ç»“æœå¦‚ä¸‹ï¼š

```js
"use strict";
var _context;
var _x = this._x;
function _next1() {
  var _fn2 = _x[2];
  _fn2(arg1, arg2, arg3, function (_err2) {
    // ...
  });
}
function _next0() {
  var _fn1 = _x[1];
  _fn1(arg1, arg2, arg3, function (_err1) {
    // ...
    _next1();
  });
}
var _fn0 = _x[0];
_fn0(arg1, arg2, arg3, function (_err0) {
  // ...
  _next0();
});
```

`Promise` æ–¹å¼

```js
const { AsyncSeriesHook } = require("tapable");

// ç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ– Hooks ç±»
// æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°åçš„å­—ç¬¦ä¸²æ•°ç»„
// è¿™ç»„å‚æ•°å’Œæ³¨å†Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰å…³ï¼Œ
const hook = new AsyncSeriesHook(["arg1", "arg2", "arg3"]);

// æ³¨å†Œ
// ç¬¬ä¸€ä¸ªå…¥å‚ä¸ºæ³¨å†Œå
// ç¬¬äºŒä¸ªä¸ºæ³¨å†Œå›è°ƒæ–¹æ³•ï¼Œå‚æ•°çš„å½¢å‚ä¸ªæ•°å’Œ`AsyncSeriesHook`çš„å…¥å‚çš„æ•°ç»„æœ‰å…³ç³»
hook.tapPromise("fn0", (arg1, arg2, arg3) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn0", arg1, arg2, arg3);
      resolve();
    }, 1000);
  });
});
hook.tapPromise("fn1", (arg1, arg2, arg3, callback) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn1", arg1, arg2, arg3);
      resolve();
    }, 1000);
  });
});
hook.tapPromise("fn2", (arg1, arg2, arg3, callback) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn2", arg1, arg2, arg3);
      resolve();
    }, 1000);
  });
});
// æ‰§è¡Œ
// æ‰§è¡Œé¡ºåºåˆ™æ˜¯æ ¹æ®è¿™ä¸ªå®ä¾‹ç±»å‹æ¥å†³å®šçš„
hook.promise("a", "b", "c");
```

`promise` ç”±[AsyncSeriesHookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesHook.js?L10:1)çš„`content`å®ç°, æ›´æ·±å±‚æ¬¡æ¥è¯´åº”è¯¥æ˜¯ç”±[HookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1)çš„[callTapsSeries](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L276)å®ç°ã€‚ ç»“æœå¦‚ä¸‹ï¼š

```js
"use strict";
var _context;
var _x = this._x;
function _next1() {
  var _fn2 = _x[2];
  var _hasResult2 = false;
  var _promise2 = _fn2(arg1, arg2, arg3);
  _promise2.then(function (_result2) {
    _hasResult2 = true;
  });
}
function _next0() {
  var _fn1 = _x[1];
  var _hasResult1 = false;
  var _promise1 = _fn1(arg1, arg2, arg3);
  _promise1.then(function (_result1) {
    _hasResult1 = true;
    _next1();
  });
}
var _fn0 = _x[0];
var _hasResult0 = false;
var _promise0 = _fn0(arg1, arg2, arg3);
_promise0.then(function (_result0) {
  _hasResult0 = true;
  _next0();
});
```

## AsyncSeriesBailHook

[AsyncSeriesBailHook](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesBailHook.js?L31) ä¼šå¯¹æ¯æ¬¡å¼‚æ­¥æ‰§è¡Œçš„ç»“æœè¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœç»“æœä¸æ˜¯ `undefined` å°±ç›´æ¥ `return` äº†ï¼Œåé¢çš„å›è°ƒå‡½æ•°å°±æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†

```js
const { AsyncSeriesBailHook } = require("tapable");
// ç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ– Hooks ç±»
// æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°åçš„å­—ç¬¦ä¸²æ•°ç»„
// è¿™ç»„å‚æ•°å’Œæ³¨å†Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰å…³ï¼Œ
const hook = new AsyncSeriesBailHook(["arg1", "arg2", "arg3"]);

// æ³¨å†Œ
// ç¬¬ä¸€ä¸ªå…¥å‚ä¸ºæ³¨å†Œå
// ç¬¬äºŒä¸ªä¸ºæ³¨å†Œå›è°ƒæ–¹æ³•ï¼Œå‚æ•°çš„å½¢å‚ä¸ªæ•°å’Œ`AsyncSeriesBailHook`çš„å…¥å‚çš„æ•°ç»„æœ‰å…³ç³»
// ä¸²è¡Œè°ƒç”¨
hook.tapPromise("fn0", (arg1, arg2, arg3) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn0", arg1, arg2, arg3);
      resolve();
    }, 1000);
  });
});
hook.tapPromise("fn1", (arg1, arg2, arg3, callback) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn1", arg1, arg2, arg3);
      resolve(12); // åé¢çš„å›è°ƒä¸ä¼šæ‰§è¡Œ
    }, 1000);
  });
});
hook.tapPromise("fn2", (arg1, arg2, arg3, callback) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn2", arg1, arg2, arg3);
      resolve();
    }, 1000);
  });
});
// æ‰§è¡Œ
// æ‰§è¡Œé¡ºåºåˆ™æ˜¯æ ¹æ®è¿™ä¸ªå®ä¾‹ç±»å‹æ¥å†³å®šçš„
hook.promise("a", "b", "c");

// æ‰§è¡Œç»“æœï¼š
// fn0 a b c
// fn1 a b c
```

`tapAsync` å’Œ `callAsync`çš„ç»„åˆåŒç†

```js
"use strict";
var _context;
var _x = this._x;
function _next1() {
  var _fn2 = _x[2];
  var _hasResult2 = false;
  var _promise2 = _fn2(arg1, arg2, arg3);
  //...
  _promise2.then(function (_result2) {
    _hasResult2 = true;
    if (_result2 !== undefined) {
      return _result2;
    } else {
    }
  });
}
function _next0() {
  var _fn1 = _x[1];
  var _hasResult1 = false;
  var _promise1 = _fn1(arg1, arg2, arg3);
  //...
  _promise1.then(
    function (_result1) {
      _hasResult1 = true;
      if (_result1 !== undefined) {
        return _result1;
      } else {
        return _next1();
      }
    }
    //...
  );
}
var _fn0 = _x[0];
var _hasResult0 = false;
var _promise0 = _fn0(arg1, arg2, arg3);
//...
_promise0.then(
  function (_result0) {
    _hasResult0 = true;
    if (_result0 !== undefined) {
      return _result0;
    } else {
      return _next0();
    }
  }
  //...
);
```

## AsyncSeriesLoopHook

[AsyncSeriesLoopHook](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesLoopHook.js?L26)ä¼šå¯¹æ¯æ¬¡å¼‚æ­¥æ‰§è¡Œçš„ç»“æœè¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœç»“æœä¸æ˜¯ `undefined` å°±ä¸åœå¾ªç¯ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°åˆ°å½“å‰å›è°ƒå‡½æ•°ï¼Œç›´è‡³éƒ½è¿”å› `undefined`ã€‚

```js
const { AsyncSeriesLoopHook } = require("tapable");
// ç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ– Hooks ç±»
// æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°åçš„å­—ç¬¦ä¸²æ•°ç»„
// è¿™ç»„å‚æ•°å’Œæ³¨å†Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰å…³ï¼Œ
const hook = new AsyncSeriesLoopHook(["arg1", "arg2", "arg3"]);

let _loop = 2; // å¾ªç¯ä¸¤æ¬¡

// æ³¨å†Œ
// ç¬¬ä¸€ä¸ªå…¥å‚ä¸ºæ³¨å†Œå
// ç¬¬äºŒä¸ªä¸ºæ³¨å†Œå›è°ƒæ–¹æ³•ï¼Œå‚æ•°çš„å½¢å‚ä¸ªæ•°å’Œ`AsyncSeriesLoopHook`çš„å…¥å‚çš„æ•°ç»„æœ‰å…³ç³»
hook.tapPromise("fn0", (arg1, arg2, arg3) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn0", arg1, arg2, arg3);
      resolve();
    }, 1000);
  });
});
hook.tapPromise("fn1", (arg1, arg2, arg3, callback) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn1", arg1, arg2, arg3);
      resolve(_loop > 0 ? "fn1 result" : undefined);
      _loop = _loop - 1;
    }, 1000);
  });
});
hook.tapPromise("fn2", (arg1, arg2, arg3, callback) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn2", arg1, arg2, arg3);
      resolve();
    }, 1000);
  });
});
// æ‰§è¡Œ
// æ‰§è¡Œé¡ºåºåˆ™æ˜¯æ ¹æ®è¿™ä¸ªå®ä¾‹ç±»å‹æ¥å†³å®šçš„
hook.promise("a", "b", "c");

// æ‰§è¡Œç»“æœ
// fn0 a b c
// fn1 a b c
// fn0 a b c // å¾ªç¯
// fn1 a b c // å¾ªç¯
// fn0 a b c // å¾ªç¯
// fn1 a b c // å¾ªç¯
// fn2 a b c
```

`tapAsync` å’Œ `callAsync`çš„ç»„åˆåŒç†

`promise` ç”±[AsyncSeriesLoopHookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesLoopHook.js?L10:1)çš„`content`å®ç°, æ›´æ·±å±‚æ¬¡æ¥è¯´åº”è¯¥æ˜¯ç”±[HookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1)çš„[callTapsLooping](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L324:2)å®ç°ã€‚ ç»“æœå¦‚ä¸‹ï¼š

```js
"use strict";
var _context;
var _x = this._x;
var _looper = function () {
  var _loopAsync = false;
  var _loop;
  do {
    _loop = false;
    function _next1() {
      var _fn2 = _x[2];
      var _hasResult2 = false;
      var _promise2 = _fn2(arg1, arg2, arg3);
      // åˆ¤æ–­è¿”å›æ˜¯ä¸æ˜¯promise
      if (!_promise2 || !_promise2.then)
        throw new Error(
          "Tap function (tapPromise) did not return promise (returned " +
            _promise2 +
            ")"
        );
      _promise2.then(
        function (_result2) {
          _hasResult2 = true;
          if (_result2 !== undefined) {
            _loop = true;
            if (_loopAsync) _looper();
          } else {
            if (!_loop) {
            }
          }
        }
        // ... reject å¤„ç†
      );
    }
    function _next0() {
      var _fn1 = _x[1];
      var _hasResult1 = false;
      var _promise1 = _fn1(arg1, arg2, arg3);
      // ...
      _promise1.then(
        function (_result1) {
          _hasResult1 = true;
          if (_result1 !== undefined) {
            _loop = true;
            if (_loopAsync) _looper();
          } else {
            _next1();
          }
        }
        // ... reject å¤„ç†
      );
    }
    var _fn0 = _x[0];
    var _hasResult0 = false;
    var _promise0 = _fn0(arg1, arg2, arg3);
    // ...
    _promise0.then(
      function (_result0) {
        _hasResult0 = true;
        if (_result0 !== undefined) {
          _loop = true;
          if (_loopAsync) _looper();
        } else {
          _next0();
        }
      }
      // ... reject å¤„ç†
    );
  } while (_loop);
  _loopAsync = true;
};
_looper();
```

## AsyncSeriesWaterfallHook

[AsyncSeriesWaterfallHook](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesWaterfallHook.js?L34)ä¼šå¯¹æ¯æ¬¡æ‰§è¡Œå¼‚æ­¥å‡½æ•°çš„ç»“æœå½“æˆä¸‹ä¸€ä¸ªå›è°ƒå‡½æ•°çš„å…¥å‚ï¼ˆ`callAsync`/`promise`çš„å…¥å‚ ï¼‰ï¼Œå¦‚æœè¿”å›å€¼æ˜¯ `undefined`ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå‚æ•°ã€‚

```js
const { AsyncSeriesWaterfallHook } = require("tapable");
// ç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ– Hooks ç±»
// æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°åçš„å­—ç¬¦ä¸²æ•°ç»„
// è¿™ç»„å‚æ•°å’Œæ³¨å†Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰å…³ï¼Œ
const hook = new AsyncSeriesWaterfallHook(["arg1", "arg2", "arg3"]);

// æ³¨å†Œ
// ç¬¬ä¸€ä¸ªå…¥å‚ä¸ºæ³¨å†Œå
// ç¬¬äºŒä¸ªä¸ºæ³¨å†Œå›è°ƒæ–¹æ³•ï¼Œå‚æ•°çš„å½¢å‚ä¸ªæ•°å’Œ`AsyncSeriesWaterfallHook`çš„å…¥å‚çš„æ•°ç»„æœ‰å…³ç³»
hook.tapPromise("fn0", (arg1, arg2, arg3) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn0", arg1, arg2, arg3);
      resolve();
    }, 1000);
  });
});
hook.tapPromise("fn1", (arg1, arg2, arg3, callback) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn1", arg1, arg2, arg3);
      resolve("fn1-result"); // è¿”å›å€¼ä½œä¸ºfn2çš„ç¬¬ä¸€ä¸ªå…¥å‚
    }, 1000);
  });
});
hook.tapPromise("fn2", (arg1, arg2, arg3, callback) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn2", arg1, arg2, arg3);
      resolve();
    }, 1000);
  });
});
// æ‰§è¡Œ
// æ‰§è¡Œé¡ºåºåˆ™æ˜¯æ ¹æ®è¿™ä¸ªå®ä¾‹ç±»å‹æ¥å†³å®šçš„
hook.promise("a", "b", "c");

// æ‰§è¡Œç»“æœ
// fn0 a b c
// fn1 a b c
// fn2 fn1-result b c
```

`tapAsync` å’Œ `callAsync`çš„ç»„åˆåŒç†

`promise` ç”±[AsyncSeriesWaterfallHookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesWaterfallHook.js?L10:1)çš„`content`å®ç°, æ›´æ·±å±‚æ¬¡æ¥è¯´åº”è¯¥æ˜¯ç”±[HookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1)çš„[callTapsSeries](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L276)å®ç°ã€‚ ç»“æœå¦‚ä¸‹ï¼š

```js
"use strict";
var _context;
var _x = this._x;
function _next2() {
  var _fn3 = _x[3];
  var _hasResult3 = false;
  var _promise3 = _fn3(arg1, arg2, arg3);
  if (!_promise3 || !_promise3.then)
    // åˆ¤æ–­è¿”å›æ˜¯ä¸æ˜¯promise
    throw new Error(
      "Tap function (tapPromise) did not return promise (returned " +
        _promise3 +
        ")"
    );
  _promise3.then(
    function (_result3) {
      _hasResult3 = true;
      if (_result3 !== undefined) {
        arg1 = _result3;
      }
      return arg1;
    }
    // ...
  );
}
function _next1() {
  var _fn2 = _x[2];
  var _hasResult2 = false;
  var _promise2 = _fn2(arg1, arg2, arg3);
  // ...
  _promise2.then(function (_result2) {
    _hasResult2 = true;
    if (_result2 !== undefined) {
      arg1 = _result2;
    }
    _next2();
  });
}
function _next0() {
  var _fn1 = _x[1];
  var _hasResult1 = false;
  var _promise1 = _fn1(arg1, arg2, arg3);
  // ...
  _promise1.then(
    function (_result1) {
      _hasResult1 = true;
      if (_result1 !== undefined) {
        arg1 = _result1;
      }
      _next1();
    }
    // ...
  );
}
var _fn0 = _x[0];
var _hasResult0 = false;
var _promise0 = _fn0(arg1, arg2, arg3);
// ...
_promise0.then(
  function (_result0) {
    _hasResult0 = true;
    if (_result0 !== undefined) {
      arg1 = _result0;
    }
    _next0();
  }
  // ...
);
```

## AsyncParallelHook

[AsyncParallelHook](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncParallelHook.js?L26:1)å¹¶è¡Œæ‰§è¡Œ, ä¸å…³å¿ƒå›è°ƒå‡½æ•°çš„è¿”å›å€¼ã€‚

```js
const { AsyncParallelHook } = require("tapable");
// ç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ– Hooks ç±»
// æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°åçš„å­—ç¬¦ä¸²æ•°ç»„
// è¿™ç»„å‚æ•°å’Œæ³¨å†Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰å…³ï¼Œ
// å¹¶è¡Œæ‰§è¡Œ ä¸å…³å¿ƒå›è°ƒå‡½æ•°çš„è¿”å›å€¼ã€‚
const hook = new AsyncParallelHook(["arg1", "arg2", "arg3"]);

// æ³¨å†Œ
// ç¬¬ä¸€ä¸ªå…¥å‚ä¸ºæ³¨å†Œå
// ç¬¬äºŒä¸ªä¸ºæ³¨å†Œå›è°ƒæ–¹æ³•ï¼Œå‚æ•°çš„å½¢å‚ä¸ªæ•°å’Œ`AsyncParallelHook`çš„å…¥å‚çš„æ•°ç»„æœ‰å…³ç³»
hook.tapPromise("fn0", (arg1, arg2, arg3) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn0", arg1, arg2, arg3);
      resolve();
    }, 1000);
  });
});
hook.tapPromise("fn1", (arg1, arg2, arg3) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn1", arg1, arg2, arg3);
      resolve("fn1-result");
    }, 1000);
  });
});
hook.tapPromise("fn2", (arg1, arg2, arg3) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn2", arg1, arg2, arg3);
      resolve();
    }, 500);
  });
});
// æ‰§è¡Œ
// æ‰§è¡Œé¡ºåºåˆ™æ˜¯æ ¹æ®è¿™ä¸ªå®ä¾‹ç±»å‹æ¥å†³å®šçš„
hook.promise("a", "b", "c");

// æ‰§è¡Œç»“æœ
// fn2 a b c
// fn0 a b c
// fn1 a b c
```

`tapAsync` å’Œ `callAsync`çš„ç»„åˆåŒç†

`promise` ç”±[AsyncParallelHookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncParallelHook.js?L10:1)çš„`content`å®ç°, æ›´æ·±å±‚æ¬¡æ¥è¯´åº”è¯¥æ˜¯ç”±[HookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1)çš„[callTapsParallel](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L376:2)å®ç°ã€‚ ç»“æœå¦‚ä¸‹ï¼š

```js
"use strict";
var _context;
var _x = this._x;
do {
  var _counter = 3;
  var _done = function () {};
  if (_counter <= 0) break;
  var _fn0 = _x[0];
  var _hasResult0 = false;
  var _promise0 = _fn0(arg1, arg2, arg3);

  // åˆ¤æ–­è¿”å›æ˜¯ä¸æ˜¯promise
  if (!_promise0 || !_promise0.then)
    throw new Error(
      "Tap function (tapPromise) did not return promise (returned " +
        _promise0 +
        ")"
    );
  _promise0.then(
    function (_result0) {
      _hasResult0 = true;
      if (--_counter === 0) _done();
    },
    function (_err0) {
      if (_hasResult0) throw _err0;
      if (_counter > 0) {
        throw _err0;
        _counter = 0;
      }
    }
  );
  if (_counter <= 0) break;
  var _fn1 = _x[1];
  var _hasResult1 = false;
  var _promise1 = _fn1(arg1, arg2, arg3);
  // ...
  _promise1.then(
    function (_result1) {
      _hasResult1 = true;
      if (--_counter === 0) _done();
    },
    function (_err1) {
      if (_hasResult1) throw _err1;
      if (_counter > 0) {
        throw _err1;
        _counter = 0;
      }
    }
  );
  if (_counter <= 0) break;
  var _fn2 = _x[2];
  var _hasResult2 = false;
  var _promise2 = _fn2(arg1, arg2, arg3);
  // ...
  _promise2.then(
    function (_result2) {
      _hasResult2 = true;
      if (--_counter === 0) _done();
    },
    function (_err2) {
      if (_hasResult2) throw _err2;
      if (_counter > 0) {
        throw _err2;
        _counter = 0;
      }
    }
  );
} while (false);
```

## AsyncParallelBailHook

[AsyncParallelBailHook](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncParallelBailHook.js?L74:1) åªè¦å›è°ƒå‡½æ•°çš„è¿”å›å€¼ä¸ä¸º `undefined`, å°±ä¼šå¿½ç•¥åé¢çš„å›è°ƒå‡½æ•°æ‰§è¡Œ, ç›´æ¥è·³è·ƒåˆ° `callAsync` ç­‰è§¦å‘å‡½æ•°ç»‘å®šçš„å›è°ƒå‡½æ•°, ç„¶åæ‰§è¡Œè¿™ä¸ªè¢«ç»‘å®šçš„å›è°ƒå‡½æ•°ã€‚

ä½¿ç”¨å’ŒåŸç†ä¸ SyncBailHook ç›¸ä¼¼

```js
const { AsyncParallelBailHook } = require("tabable");
// ç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ– Hooks ç±»
// æ¥æ”¶ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‚æ•°åçš„å­—ç¬¦ä¸²æ•°ç»„
// è¿™ç»„å‚æ•°å’Œæ³¨å†Œå›è°ƒå‡½æ•°çš„å‚æ•°æœ‰å…³ï¼Œ
// å¹¶è¡Œæ‰§è¡Œ ä¸å…³å¿ƒå›è°ƒå‡½æ•°çš„è¿”å›å€¼ã€‚
const hook = new AsyncParallelBailHook(["arg1", "arg2", "arg3"]);

// æ³¨å†Œ
// ç¬¬ä¸€ä¸ªå…¥å‚ä¸ºæ³¨å†Œå
// ç¬¬äºŒä¸ªä¸ºæ³¨å†Œå›è°ƒæ–¹æ³•ï¼Œå‚æ•°çš„å½¢å‚ä¸ªæ•°å’Œ`AsyncParallelBailHook`çš„å…¥å‚çš„æ•°ç»„æœ‰å…³ç³»
hook.tapPromise("fn0", (arg1, arg2, arg3) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn0", arg1, arg2, arg3);
      resolve();
    }, 1000);
  });
});
hook.tapPromise("fn1", (arg1, arg2, arg3) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn1", arg1, arg2, arg3);
      resolve("fn1-result");
    }, 1000);
  });
});
hook.tapPromise("fn2", (arg1, arg2, arg3) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log("fn2", arg1, arg2, arg3);
      resolve();
    }, 500);
  });
});
// æ‰§è¡Œ
// æ‰§è¡Œé¡ºåºåˆ™æ˜¯æ ¹æ®è¿™ä¸ªå®ä¾‹ç±»å‹æ¥å†³å®šçš„
hook.promise("a", "b", "c");

// æ‰§è¡Œç»“æœ
// fn2 a b c
// fn0 a b c
// fn1 a b c
```

`tapAsync` å’Œ `callAsync`çš„ç»„åˆåŒç†

`promise` ç”±[AsyncParallelBailHookCodeFactory](https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncParallelBailHook.js?L10:1)çš„`content`å®ç°ã€‚ ç»“æœå¦‚ä¸‹ï¼š

```js
"use strict";
var _context;
var _x = this._x;
var _results = new Array(3);
var _checkDone = function () {
  for (var i = 0; i < _results.length; i++) {
    var item = _results[i];
    if (item === undefined) return false;
    if (item.result !== undefined) {
      return item.result;
      return true;
    }
    if (item.error) {
      throw item.error;
      return true;
    }
  }
  return false;
};
do {
  var _counter = 3;
  var _done = function () {};
  if (_counter <= 0) break;
  var _fn0 = _x[0];
  var _hasResult0 = false;
  var _promise0 = _fn0(arg1, arg2, arg3);
  // åˆ¤æ–­è¿”å›æ˜¯ä¸æ˜¯promise
  if (!_promise0 || !_promise0.then)
    throw new Error(
      "Tap function (tapPromise) did not return promise (returned " +
        _promise0 +
        ")"
    );
  _promise0.then(
    function (_result0) {
      _hasResult0 = true;
      if (_counter > 0) {
        if (
          0 < _results.length &&
          (_result0 !== undefined && (_results.length = 1),
          (_results[0] = { result: _result0 }),
          _checkDone())
        ) {
          _counter = 0;
        } else {
          if (--_counter === 0) _done();
        }
      }
    },
    function (_err0) {
      if (_hasResult0) throw _err0;
      if (_counter > 0) {
        if (
          0 < _results.length &&
          ((_results.length = 1),
          (_results[0] = { error: _err0 }),
          _checkDone())
        ) {
          _counter = 0;
        } else {
          if (--_counter === 0) _done();
        }
      }
    }
  );
  if (_counter <= 0) break;
  if (1 >= _results.length) {
    if (--_counter === 0) _done();
  } else {
    var _fn1 = _x[1];
    var _hasResult1 = false;
    var _promise1 = _fn1(arg1, arg2, arg3);
    // ...
    _promise1.then(
      function (_result1) {
        _hasResult1 = true;
        if (_counter > 0) {
          if (
            1 < _results.length &&
            (_result1 !== undefined && (_results.length = 2),
            (_results[1] = { result: _result1 }),
            _checkDone())
          ) {
            _counter = 0;
          } else {
            if (--_counter === 0) _done();
          }
        }
      },
      function (_err1) {
        if (_hasResult1) throw _err1;
        if (_counter > 0) {
          if (
            1 < _results.length &&
            ((_results.length = 2),
            (_results[1] = { error: _err1 }),
            _checkDone())
          ) {
            _counter = 0;
          } else {
            if (--_counter === 0) _done();
          }
        }
      }
    );
  }
  if (_counter <= 0) break;
  if (2 >= _results.length) {
    if (--_counter === 0) _done();
  } else {
    var _fn2 = _x[2];
    var _hasResult2 = false;
    var _promise2 = _fn2(arg1, arg2, arg3);
    // ...
    _promise2.then(
      function (_result2) {
        _hasResult2 = true;
        if (_counter > 0) {
          if (
            2 < _results.length &&
            (_result2 !== undefined && (_results.length = 3),
            (_results[2] = { result: _result2 }),
            _checkDone())
          ) {
            _counter = 0;
          } else {
            if (--_counter === 0) _done();
          }
        }
      },
      function (_err2) {
        if (_hasResult2) throw _err2;
        if (_counter > 0) {
          if (
            2 < _results.length &&
            ((_results.length = 3),
            (_results[2] = { error: _err2 }),
            _checkDone())
          ) {
            _counter = 0;
          } else {
            if (--_counter === 0) _done();
          }
        }
      }
    );
  }
} while (false);
```

å‚è€ƒ

[tapable](https://github.com/webpack/tapable)

[webpack æ ¸å¿ƒæ¨¡å— tapable æºç è§£æ](https://www.cnblogs.com/dennisj/p/14606902.html)
