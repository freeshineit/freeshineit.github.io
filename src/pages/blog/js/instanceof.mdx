import MDXContentCom from "../../../components/MDXContent";
import { RandomCover } from "@constant";

export const meta = {
  title: "javascript instanceof åŸç†",
  description:
    "javascript instanceof åŸç†, instanceof è¿ç®—ç¬¦ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ prototype å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚",
  date: "2022-10-26",
  cover: RandomCover[2]
};

export default ({ children }) => (
  <MDXContentCom meta={meta}>{children}</MDXContentCom>
);

## instanceof åŸç†

[instanceof](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof) è¿ç®—ç¬¦ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ prototype å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚

## å®ç°

```ts
/**
 *
 * ç®€å•æ¨¡æ‹Ÿ instanceofçš„å®ç°
 *
 * https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof
 *
 * instanceof è¿ç®—ç¬¦ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ prototype å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚
 *
 * éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¡¨è¾¾å¼ obj instanceof Foo è¿”å› trueï¼Œåˆ™å¹¶ä¸æ„å‘³ç€è¯¥è¡¨è¾¾å¼ä¼šæ°¸è¿œè¿”å› trueï¼Œ
 * å› ä¸º Foo.prototype å±æ€§çš„å€¼æœ‰å¯èƒ½ä¼šæ”¹å˜ï¼Œæ”¹å˜ä¹‹åçš„å€¼å¾ˆæœ‰å¯èƒ½ä¸å­˜åœ¨äº obj çš„åŸå‹é“¾ä¸Šï¼Œ
 * è¿™æ—¶åŸè¡¨è¾¾å¼çš„å€¼å°±ä¼šæˆä¸º falseã€‚å¦å¤–ä¸€ç§æƒ…å†µä¸‹ï¼ŒåŸè¡¨è¾¾å¼çš„å€¼ä¹Ÿä¼šæ”¹å˜ï¼Œå°±æ˜¯æ”¹å˜å¯¹è±¡ obj çš„åŸå‹é“¾çš„æƒ…å†µï¼Œè™½ç„¶åœ¨ç›®å‰çš„ ES è§„èŒƒä¸­ï¼Œ
 * æˆ‘ä»¬åªèƒ½è¯»å–å¯¹è±¡çš„åŸå‹è€Œä¸èƒ½æ”¹å˜å®ƒï¼Œä½†å€ŸåŠ©äºéæ ‡å‡†çš„ __proto__ ä¼ªå±æ€§ï¼Œæ˜¯å¯ä»¥å®ç°çš„ã€‚
 * æ¯”å¦‚æ‰§è¡Œ obj.__proto__ = {} ä¹‹åï¼Œobj instanceof Foo å°±ä¼šè¿”å› false äº†ã€‚
 *
 *
 * @param instance å®ä¾‹å¯¹è±¡
 * @param Func æ„é€ å‡½æ•°
 * @returns boolean
 */
function _instanceof(instance: any, Func: any) {
  let instance_proto = instance.__proto__;
  let FuncProto = Func.prototype;

  while (true) {
    if (instance_proto === null) {
      return false;
    }
    if (instance_proto === FuncProto) {
      return true;
    }

    instance_proto = instance_proto.__proto__;
  }
}

(function () {
  // npx ts-node app/typeof.ts
  // å¦‚æœæœ‰é”™ ä¼šæœ‰æ‰“å°
  const assert = require("assert");

  // å®šä¹‰æ„é€ å‡½æ•°
  function C() {}
  function D() {}

  let o = new (C as any)();

  assert.equal(o instanceof C, _instanceof(o, C));
  assert.equal(o instanceof Object, _instanceof(o, Object));
  assert.equal(C.prototype instanceof Object, _instanceof(C.prototype, Object));

  //
  C.prototype = {};
  let o2 = new (C as any)();
  assert.equal(o instanceof C, _instanceof(o2, C));

  //  falseï¼ŒC.prototype æŒ‡å‘äº†ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œè¿™ä¸ªç©ºå¯¹è±¡ä¸åœ¨ o çš„åŸå‹é“¾ä¸Šã€‚
  assert.equal(false, _instanceof(o, C));

  D.prototype = new (C as any)(); // ç»§æ‰¿

  let o3 = new (D as any)();

  assert.equal(o3 instanceof D, _instanceof(o3, D));

  // true å› ä¸º C.prototype ç°åœ¨åœ¨ o3 çš„åŸå‹é“¾ä¸Š
  assert.equal(o3 instanceof C, _instanceof(o3, C));
})();
```

ä¸€ä¸ªç®€å•çš„å®ç°ï¼Œ å¦‚æœ‰è€ƒè™‘ä¸å®Œå–„çš„åœ°æ–¹è¯·å¸®å¿™æŒ‡å‡ºè¿›è¡Œå®Œå–„[issues](https://github.com/freeshineit/freeshineit.github.io/issues)ï¼Œ è°¢è°¢ ğŸ™
