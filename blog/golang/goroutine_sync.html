<!DOCTYPE html><html><head><link rel="shortcut icon" href="https://www.nextjs.cn/static/favicon/favicon.ico"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="format-detection" content="telephone=no, email=no"/><title>goroutine 同步操作 (ShineShao)</title><meta name="description" content="goroutine 同步操作 sync.WaitGroup/Channels"/><meta name="keywords" content="ShineShao freeshineit Next.js Blog "/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/5a238a54fe65047317ed.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5a238a54fe65047317ed.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-0cb069610457c13661fc.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-b9780dc6f4fa7abb3771.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f87d71655bebed8b9ef8.js" defer=""></script><script src="/_next/static/chunks/pages/blog/golang/goroutine_sync-97c2254c5db7a8ea00a1.js" defer=""></script><script src="/_next/static/5iiJ-qiM60iclVICUMPq2/_buildManifest.js" defer=""></script><script src="/_next/static/5iiJ-qiM60iclVICUMPq2/_ssgManifest.js" defer=""></script></head><body class="custom_class"><div id="__next"><div class="Layout_layout__3guix main-mdx" style="width:100%"><header class="Layout_header__1Ex29"><div class="Layout_container__2QLYW"><nav><ul><li><a href="/">Home</a></li><li><a href="/blog">Blog</a></li><li><a href="/readme">README</a></li></ul></nav><div class="Layout_right__2NMHu"><div class="Layout_Theme__3HBe3">🌜</div><a href="https://github.com/freeshineit" target="_block"><img src="/static/images/ShineShao.jpg" alt="ShineShao" class="ShineShao_ShineShao__3y7j0" style="width:34px;height:34px;border-radius:50%"/></a></div></div></header><div class="Layout_main__3m1yK" style="margin:0 auto"><div class="mdx-box"><article><h2 id="golang-goroutine-同步操作" class="Heading_H2__2MwMw h2-tag"><a aria-hidden="true" tabindex="-1" href="#golang-goroutine-同步操作" class="A_A__LqrNw a-tag"><span class="icon icon-link"></span></a>golang goroutine 同步操作</h2><h3 id="syncwaitgroup" class="Heading_H3__1b6dn h3-tag"><a aria-hidden="true" tabindex="-1" href="#syncwaitgroup" class="A_A__LqrNw a-tag"><span class="icon icon-link"></span></a><a href="https://golang.org/pkg/sync/#WaitGroup" class="A_A__LqrNw a-tag">sync.WaitGroup</a></h3><div class="Pre_Pre__269fU pre-tag"><pre class="Code_pre__r85Dc pre-tag prism-code language-go " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__1zO4b">go</span><div class="token-line"><span class="token keyword" style="display:inline-block">package</span><span class="token plain" style="display:inline-block"> main</span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">import</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token string" style="display:inline-block">&quot;fmt&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token string" style="display:inline-block">&quot;sync&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token string" style="display:inline-block">&quot;time&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">func</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">worker</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">i </span><span class="token builtin" style="display:inline-block">int</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> wg </span><span class="token operator" style="display:inline-block">*</span><span class="token plain" style="display:inline-block">sync</span><span class="token punctuation" style="display:inline-block">.</span><span class="token plain" style="display:inline-block">WaitGroup</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    fmt</span><span class="token punctuation" style="display:inline-block">.</span><span class="token function" style="display:inline-block">Printf</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;sync worker %d starting\n&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> i</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    time</span><span class="token punctuation" style="display:inline-block">.</span><span class="token function" style="display:inline-block">Sleep</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">time</span><span class="token punctuation" style="display:inline-block">.</span><span class="token plain" style="display:inline-block">Second</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    fmt</span><span class="token punctuation" style="display:inline-block">.</span><span class="token function" style="display:inline-block">Printf</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;sync worker %d done\n&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> i</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">defer</span><span class="token plain" style="display:inline-block"> wg</span><span class="token punctuation" style="display:inline-block">.</span><span class="token function" style="display:inline-block">Done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// sync.WaitGroup</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">func</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">SyncWaitGroup</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> wg sync</span><span class="token punctuation" style="display:inline-block">.</span><span class="token plain" style="display:inline-block">WaitGroup</span></div><div class="token-line"><span class="token plain" style="display:inline-block">    fmt</span><span class="token punctuation" style="display:inline-block">.</span><span class="token function" style="display:inline-block">Println</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;this is SyncWaitGroup func&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">for</span><span class="token plain" style="display:inline-block"> i </span><span class="token operator" style="display:inline-block">:=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> i </span><span class="token operator" style="display:inline-block">&lt;=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">10</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> i</span><span class="token operator" style="display:inline-block">++</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token comment" style="display:inline-block">// 创建10个 goroutine</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        wg</span><span class="token punctuation" style="display:inline-block">.</span><span class="token function" style="display:inline-block">Add</span><span class="token punctuation" style="display:inline-block">(</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword" style="display:inline-block">go</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">worker</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">i</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&amp;</span><span class="token plain" style="display:inline-block">wg</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    wg</span><span class="token punctuation" style="display:inline-block">.</span><span class="token function" style="display:inline-block">Wait</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span></div></pre></div><h3 id="channels" class="Heading_H3__1b6dn h3-tag"><a aria-hidden="true" tabindex="-1" href="#channels" class="A_A__LqrNw a-tag"><span class="icon icon-link"></span></a><a href="https://blog.golang.org/pipelines" class="A_A__LqrNw a-tag">Channels</a></h3><div class="Pre_Pre__269fU pre-tag"><pre class="Code_pre__r85Dc pre-tag prism-code language-go " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__1zO4b">go</span><div class="token-line"><span class="token keyword" style="display:inline-block">package</span><span class="token plain" style="display:inline-block"> main</span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">import</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token string" style="display:inline-block">&quot;fmt&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token string" style="display:inline-block">&quot;time&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">func</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">chanWorker</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">i </span><span class="token builtin" style="display:inline-block">int</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> done </span><span class="token keyword" style="display:inline-block">chan</span><span class="token plain" style="display:inline-block"> </span><span class="token builtin" style="display:inline-block">int</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    fmt</span><span class="token punctuation" style="display:inline-block">.</span><span class="token function" style="display:inline-block">Printf</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;chan worker %d starting\n&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> i</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    time</span><span class="token punctuation" style="display:inline-block">.</span><span class="token function" style="display:inline-block">Sleep</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">time</span><span class="token punctuation" style="display:inline-block">.</span><span class="token plain" style="display:inline-block">Second</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    fmt</span><span class="token punctuation" style="display:inline-block">.</span><span class="token function" style="display:inline-block">Printf</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;chan worker %d done\n&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> i</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    done </span><span class="token operator" style="display:inline-block">&lt;-</span><span class="token plain" style="display:inline-block"> i</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// chan</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">func</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">Channel</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    c </span><span class="token operator" style="display:inline-block">:=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">make</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">chan</span><span class="token plain" style="display:inline-block"> </span><span class="token builtin" style="display:inline-block">int</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    fmt</span><span class="token punctuation" style="display:inline-block">.</span><span class="token function" style="display:inline-block">Println</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;this is Channel func&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">for</span><span class="token plain" style="display:inline-block"> i </span><span class="token operator" style="display:inline-block">:=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> i </span><span class="token operator" style="display:inline-block">&lt;=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">10</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> i</span><span class="token operator" style="display:inline-block">++</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token comment" style="display:inline-block">// 创建10个 goroutine</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword" style="display:inline-block">go</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">chanWorker</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">i</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> c</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token operator" style="display:inline-block">&lt;-</span><span class="token plain" style="display:inline-block">c</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span></div></pre></div></article></div></div><footer class="Layout_footer__1xrEh"><span style="margin-right:20px">I&#x27;m here </span><a href="https://github.com/freeshineit" target="_block">ShineShao</a><a href="https://github.com/freeshineit/freeshineit.github.io/issues" target="_blank" style="margin-left:20px">issues</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/golang/goroutine_sync","query":{},"buildId":"5iiJ-qiM60iclVICUMPq2","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script><script src="/static/js/heading.js"></script></body></html>