<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="format-detection" content="telephone=no, email=no"/><title>tapable 简单使用随笔 (ShineShao)</title><meta name="description" content="The tapable package expose many Hook classes, which can be used to create hooks for plugins.tapable 是一个发布订阅模式的实现，它提供了很多应对业务的 hooks 实现和抽象。主要分为两大类同步和异步。 ShineShao 博客"/><meta name="keywords" content="ShineShao freeshineit Next.js Blog "/><meta name="next-head-count" content="8"/><link rel="shortcut icon" href="https://www.nextjs.cn/static/favicon/favicon.ico"/><script>var _hmt = _hmt || [];(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?50c47ad58047f480726591cca679297b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="preload" href="/_next/static/css/b3c88d5a6ecf92b8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b3c88d5a6ecf92b8.css" data-n-g=""/><link rel="preload" href="/_next/static/css/a643c4831a34d54c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a643c4831a34d54c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-dc0e1a98ad447e36.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-d719a31ca00eb19c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4ef93aa4e983de77.js" defer=""></script><script src="/_next/static/chunks/690-080b0e20800eb5c6.js" defer=""></script><script src="/_next/static/chunks/pages/blog/webpack/tapable-88afbfa7906373c8.js" defer=""></script><script src="/_next/static/tB7W_VdXUNRMG6ghQl1sJ/_buildManifest.js" defer=""></script><script src="/_next/static/tB7W_VdXUNRMG6ghQl1sJ/_ssgManifest.js" defer=""></script></head><body class="custom_class"><div id="__next" data-reactroot=""><div class="Layout_layout__3EeJ7 main-mdx" style="width:100%"><header class="Layout_header__LFgCt"><div class="Layout_container__ZgHhB"><nav><ul><li><a href="/">Home</a></li><li><a href="/blog">Blog</a></li><li><a href="/readme">README</a></li></ul></nav><div class="Layout_right__74zxP"><div class="Layout_Theme__yuqHW">🌜</div><a href="https://github.com/freeshineit" target="_block"><img src="/static/images/ShineShao.jpg" alt="ShineShao" class="ShineShao_ShineShao__X1C7d" style="width:34px;height:34px;border-radius:50%"/></a></div></div></header><div class="Layout_main__Obm0h" style="margin:0 auto"><div class="Cover_top__ZrW3_"><div class="Cover_coverWrapper__ORBLm"><div class="Cover_cover__946TB" style="background-image:url(/static/images/webpack.png)"></div><div class="Cover_coverBg__kRvQ4"></div><div class="Cover_dateWrapper__LkZQ2"><span class="Cover_date__EoZZG"><span class="Cover_dateDay__h46lo">28</span><span class="Cover_dateMonth__ygp2w">Nov</span><span class="Cover_dateMonth__ygp2w">2022</span></span><h1>tapable 简单使用随笔</h1></div></div></div><div class="Content_content__JCitR"><article><h2 id="tapable" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#tapable"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>tapable</h2><p class="P_P__ZiYJk p-tag">The <a href="https://github.com/webpack/tapable" class="A_A__VTs6i a-tag">tapable</a> package expose many Hook classes, which can be used to create hooks for plugins.</p><p class="P_P__ZiYJk p-tag"><code>tapable</code> 是一个发布订阅模式的实现，它提供了很多应对业务的 <code>hooks</code> 实现和抽象。主要分为两大类同步和异步。</p><h2 id="base-hooks" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#base-hooks"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>Base Hooks</h2><ul class="List_Ul__HN_A_ ul-tag"><li class="li-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/Hook.js?L25:1" class="A_A__VTs6i a-tag">Hooks</a></li></ul><p class="P_P__ZiYJk p-tag">继承 <code>Hooks</code> 的类需要自己实现<code>compile</code>抽象方法。</p><ul class="List_Ul__HN_A_ ul-tag"><li class="li-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1" class="A_A__VTs6i a-tag">HookCodeFactory</a></li></ul><p class="P_P__ZiYJk p-tag">继承<code>HookCodeFactory</code>类需要实现抽象方法<code>content</code>, 返回 <code>call</code>或<code>callAsync</code>或<code>promise</code> 的函数体的实现的代码字符串， 然后使用 <code>Function</code> 生成一个<code>call</code>或<code>callAsync</code>或<code>promise</code> 函数</p><h2 id="synchook" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#synchook"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>SyncHook</h2><p class="P_P__ZiYJk p-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncHook.js?L35:1" class="A_A__VTs6i a-tag">SyncHook</a> 按注册的回调函数串行之行。</p><p class="P_P__ZiYJk p-tag">简单使用：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">SyncHook</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;tapable&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 简单来说就是实例化 Hooks 类</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 接收一个可选参数，参数是一个参数名的字符串数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这组参数和注册回调函数的参数有关，</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> hook </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">SyncHook</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">[</span><span class="token string" style="display:inline-block">&quot;arg1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg3&quot;</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注册</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第一个入参为注册名</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第二个为注册回调方法，参数的形参个数和`SyncHook`的入参的数组有关系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> </span><span class="token comment" style="display:inline-block">// 回调函数的返回值之间没有联系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token number" style="display:inline-block">3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行顺序则是根据这个实例类型来决定的</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">call</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;a&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;b&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;c&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>call</code>由<a href="https://sourcegraph.com/search?q=context:global+repo:%5Egithub%5C.com/webpack/tapable%24+SyncHookCodeFactory&amp;patternType=standard&amp;sm=1" class="A_A__VTs6i a-tag">SyncHookCodeFactory</a>的<code>content</code>实现, 结果如下：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token comment" style="display:inline-block">// 这是一段`call`方法实现的代码字符串</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这段代码需要使用 `Function` 来生成`call`方法来执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 其中`this._x`就是注册的回调函数组成的数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 可以看出回调函数的调用就是把数组中的函数展开</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _context</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _x </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">_x</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token function" style="display:inline-block">_fn0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> </span><span class="token comment" style="display:inline-block">// 回调函数 fn0</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token function" style="display:inline-block">_fn1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> </span><span class="token comment" style="display:inline-block">// 回调函数 fn1</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token function" style="display:inline-block">_fn2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> </span><span class="token comment" style="display:inline-block">// 回调函数 fn2</span></div></div></pre></div><h2 id="syncbailhook" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#syncbailhook"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>SyncBailHook</h2><p class="P_P__ZiYJk p-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncBailHook.js?L40:1" class="A_A__VTs6i a-tag">SyncBailHook</a> 会对每次执行的结果进行检测，如果结果不是 <code>undefined</code> 就直接 <code>return</code> 了，后面的回调函数就没有机会执行了。</p><p class="P_P__ZiYJk p-tag">简单使用：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">SyncBailHook</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;tapable&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 简单来说就是实例化 Hooks 类</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 接收一个可选参数，参数是一个参数名的字符串数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这组参数和注册回调函数的参数有关，</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 同步执行回调函数，回调函数返回结果不是 `undefined` 就直接 `return` 了，后面的回调函数就没有机会执行了</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> hook </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">SyncBailHook</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">[</span><span class="token string" style="display:inline-block">&quot;arg1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg3&quot;</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注册</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第一个入参为注册名</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第二个为注册回调方法，参数的形参个数和`SyncBailHook`的入参的数组有关系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 如果回调函数的返回结果不是 `undefined` 就直接 `return` 了，后面的回调函数就没有机会执行了</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行顺序则是根据这个实例类型来决定的</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">call</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;a&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;b&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;c&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>call</code>由<code>SyncBailHookCodeFactory</code>的<code>content</code>实现, 结果如下：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token comment" style="display:inline-block">// 这是一段`call`方法实现的代码字符串</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 参数和SyncHook是一致的，区别在于回调函数的返回值</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 如果回调函数的返回结果不是 `undefined` 就直接 `return` 了，后面的回调函数就没有机会执行了。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 就像一个有限的套娃🪆</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _context</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _x </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">_x</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _result0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 如果返回结果不是 `undefined` 就直接 `return` 了，后面的回调函数就没有机会执行了。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result0 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> _result0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _result1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 如果返回结果不是 `undefined` 就直接 `return` 了，后面的回调函数就没有机会执行了。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result1 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> _result1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _result2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block">// 如果返回结果不是 `undefined` 就直接 `return` 了，后面的回调函数就没有机会执行了。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result2 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> _result2</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span></div></div></pre></div><h2 id="syncloophook" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#syncloophook"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>SyncLoopHook</h2><p class="P_P__ZiYJk p-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncLoopHook.js?L35:1" class="A_A__VTs6i a-tag">SyncLoopHook</a> 会对每次执行的结果进行检测，如果结果不是 <code>undefined</code> 就不停循环第一个回调函数到当前回调函数，直至都返回 <code>undefined</code>。</p><p class="P_P__ZiYJk p-tag">简单使用：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">SyncLoopHook</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;tapable&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 简单来说就是实例化 Hooks 类</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 接收一个可选参数，参数是一个参数名的字符串数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这组参数和注册回调函数的参数有关，</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> hook </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">SyncLoopHook</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">[</span><span class="token string" style="display:inline-block">&quot;arg1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg3&quot;</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">let</span><span class="token plain" style="display:inline-block"> _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">4</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注册</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第一个入参为注册名</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第二个为注册回调方法，参数的形参个数和`SyncLoopHook`的入参的数组有关系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _loop </span><span class="token operator" style="display:inline-block">-</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 如果返回结果不是 `undefined` 就不停循环 `f0` `f1`，直至都返回 `undefined`。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> _loop </span><span class="token operator" style="display:inline-block">&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">?</span><span class="token plain" style="display:inline-block"> _loop </span><span class="token operator" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行顺序则是根据这个实例类型来决定的</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">call</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;a&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;b&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;c&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>call</code>由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncLoopHook.js?L10:1" class="A_A__VTs6i a-tag">SyncLoopHookCodeFactory</a>的<code>content</code>实现, 结果如下：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token comment" style="display:inline-block">// 这是一段`call`方法实现的代码字符串</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 参数和SyncHook是一致的，区别在于回调函数的返回值</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 如果结果不是 `undefined` 就不停循环第一个回调函数到当前回调函数，直至都返回 `undefined`</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注意: 不返回`undefined`就不停循环，容易造成死循环</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _context</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _x </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">_x</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _loop</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword control-flow" style="display:inline-block">do</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _result0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result0 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _result1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result1 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _result2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result2 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">!</span><span class="token plain" style="display:inline-block">_loop</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">while</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_loop</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><h2 id="syncwaterfallhook" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#syncwaterfallhook"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>SyncWaterfallHook</h2><p class="P_P__ZiYJk p-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncWaterfallHook.js?L44" class="A_A__VTs6i a-tag">SyncWaterfallHook</a> 会对每次执行的结果当成下一个回调函数的入参（<code>call</code>的入参 ），如果返回值是 <code>undefined</code>，使用上一个参数。</p><p class="P_P__ZiYJk p-tag">简单使用：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">SyncWaterfallHook</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;tapable&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 简单来说就是实例化 Hooks 类</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 接收一个可选参数，参数是一个参数名的字符串数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这组参数和注册回调函数的参数有关，</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> hook </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">SyncWaterfallHook</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">[</span><span class="token string" style="display:inline-block">&quot;arg1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg3&quot;</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注册</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第一个入参为注册名</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第二个为注册回调方法，参数的形参个数和`SyncWaterfallHook`的入参的数组有关系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;fn0-result&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tap</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn3&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn3&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;fn3&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行顺序则是根据这个实例类型来决定的</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">call</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;a&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;b&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;c&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行结果：</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn0 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn1 fn0-result b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn2 fn0-result b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn3 fn2 b c</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>call</code>由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/SyncWaterfallHook.js?L10:7" class="A_A__VTs6i a-tag">SyncWaterfallHookCodeFactory</a>的<code>content</code>实现, 结果如下：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token comment" style="display:inline-block">// 这是一段`call`方法实现的代码字符串</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 参数和SyncHook是一致的，区别在于回调函数的返回值</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 如果返回值是 `undefined` , 使用`call`的参数，否则使用返回的值</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _context</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _x </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">_x</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _result0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result0 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 如果返回值是 `undefined` , 使用`call`的参数，否则使用返回的值</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  arg1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _result0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _result1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result1 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 如果返回值是 `undefined` , 使用`call`的参数，否则使用返回的值</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  arg1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _result1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _result2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result2 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 如果返回值是 `undefined` , 使用`call`的参数，否则使用返回的值</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  arg1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _result2</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn3 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">3</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _result3 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn3</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result3 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  arg1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _result3</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><h2 id="asyncserieshook" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#asyncserieshook"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>AsyncSeriesHook</h2><p class="P_P__ZiYJk p-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesHook.js?L26:1" class="A_A__VTs6i a-tag">AsyncSeriesHook</a>异步串行</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">AsyncSeriesHook</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;tapable&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 简单来说就是实例化 Hooks 类</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 接收一个可选参数，参数是一个参数名的字符串数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这组参数和注册回调函数的参数有关，</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> hook </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">AsyncSeriesHook</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">[</span><span class="token string" style="display:inline-block">&quot;arg1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg3&quot;</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注册</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第一个入参为注册名</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第二个为注册回调方法，参数的形参个数和`AsyncSeriesHook`的入参的数组有关系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapAsync</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> callback</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">callback</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapAsync</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> callback</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">callback</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapAsync</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> callback</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">callback</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> </span><span class="token comment" style="display:inline-block">// 决定 `callAsync` 最后的实参callback是否会被调用</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行顺序则是根据这个实例类型来决定的</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">callAsync</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;a&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;b&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;c&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;AsyncSeriesHook async&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行结果：</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn0 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn1 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn2 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// AsyncSeriesHook async</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>callAsync</code> 由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesHook.js?L10:1" class="A_A__VTs6i a-tag">AsyncSeriesHookCodeFactory</a>的<code>content</code>实现, 更深层次来说应该是由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1" class="A_A__VTs6i a-tag">HookCodeFactory</a>的<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L276" class="A_A__VTs6i a-tag">callTapsSeries</a>实现。 结果如下：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _context</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _x </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">_x</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token function" style="display:inline-block">_fn2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_err2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token function" style="display:inline-block">_fn1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_err1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">_next1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token function" style="display:inline-block">_fn0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_err0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token function" style="display:inline-block">_next0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>Promise</code> 方式</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">AsyncSeriesHook</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;tapable&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 简单来说就是实例化 Hooks 类</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 接收一个可选参数，参数是一个参数名的字符串数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这组参数和注册回调函数的参数有关，</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> hook </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">AsyncSeriesHook</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">[</span><span class="token string" style="display:inline-block">&quot;arg1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg3&quot;</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注册</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第一个入参为注册名</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第二个为注册回调方法，参数的形参个数和`AsyncSeriesHook`的入参的数组有关系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> callback</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> callback</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行顺序则是根据这个实例类型来决定的</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;a&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;b&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;c&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>promise</code> 由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesHook.js?L10:1" class="A_A__VTs6i a-tag">AsyncSeriesHookCodeFactory</a>的<code>content</code>实现, 更深层次来说应该是由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1" class="A_A__VTs6i a-tag">HookCodeFactory</a>的<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L276" class="A_A__VTs6i a-tag">callTapsSeries</a>实现。 结果如下：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _context</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _x </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">_x</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _promise2</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _promise1</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">_next1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">_promise0</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token function" style="display:inline-block">_next0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><h2 id="asyncseriesbailhook" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#asyncseriesbailhook"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>AsyncSeriesBailHook</h2><p class="P_P__ZiYJk p-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesBailHook.js?L31" class="A_A__VTs6i a-tag">AsyncSeriesBailHook</a> 会对每次异步执行的结果进行检测，如果结果不是 <code>undefined</code> 就直接 <code>return</code> 了，后面的回调函数就没有机会执行了</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">AsyncSeriesBailHook</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;tapable&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 简单来说就是实例化 Hooks 类</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 接收一个可选参数，参数是一个参数名的字符串数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这组参数和注册回调函数的参数有关，</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> hook </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">AsyncSeriesBailHook</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">[</span><span class="token string" style="display:inline-block">&quot;arg1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg3&quot;</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注册</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第一个入参为注册名</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第二个为注册回调方法，参数的形参个数和`AsyncSeriesBailHook`的入参的数组有关系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 串行调用</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> callback</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token number" style="display:inline-block">12</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> </span><span class="token comment" style="display:inline-block">// 后面的回调不会执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> callback</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行顺序则是根据这个实例类型来决定的</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;a&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;b&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;c&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行结果：</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn0 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn1 a b c</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>tapAsync</code> 和 <code>callAsync</code>的组合同理</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _context</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _x </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">_x</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">//...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _promise2</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result2 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> _result2</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">//...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _promise1</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result1 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> _result1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block">//...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">//...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">_promise0</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result0 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> _result0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">//...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><h2 id="asyncseriesloophook" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#asyncseriesloophook"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>AsyncSeriesLoopHook</h2><p class="P_P__ZiYJk p-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesLoopHook.js?L26" class="A_A__VTs6i a-tag">AsyncSeriesLoopHook</a>会对每次异步执行的结果进行检测，如果结果不是 <code>undefined</code> 就不停循环第一个回调函数到当前回调函数，直至都返回 <code>undefined</code>。</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">AsyncSeriesLoopHook</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;tapable&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 简单来说就是实例化 Hooks 类</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 接收一个可选参数，参数是一个参数名的字符串数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这组参数和注册回调函数的参数有关，</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> hook </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">AsyncSeriesLoopHook</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">[</span><span class="token string" style="display:inline-block">&quot;arg1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg3&quot;</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">let</span><span class="token plain" style="display:inline-block"> _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> </span><span class="token comment" style="display:inline-block">// 循环两次</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注册</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第一个入参为注册名</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第二个为注册回调方法，参数的形参个数和`AsyncSeriesLoopHook`的入参的数组有关系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> callback</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_loop </span><span class="token operator" style="display:inline-block">&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">?</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;fn1 result&quot;</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _loop </span><span class="token operator" style="display:inline-block">-</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> callback</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行顺序则是根据这个实例类型来决定的</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;a&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;b&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;c&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行结果</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn0 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn1 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn0 a b c // 循环</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn1 a b c // 循环</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn0 a b c // 循环</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn1 a b c // 循环</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn2 a b c</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>tapAsync</code> 和 <code>callAsync</code>的组合同理</p><p class="P_P__ZiYJk p-tag"><code>promise</code> 由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesLoopHook.js?L10:1" class="A_A__VTs6i a-tag">AsyncSeriesLoopHookCodeFactory</a>的<code>content</code>实现, 更深层次来说应该是由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1" class="A_A__VTs6i a-tag">HookCodeFactory</a>的<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L324:2" class="A_A__VTs6i a-tag">callTapsLooping</a>实现。 结果如下：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _context</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _x </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">_x</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> </span><span class="token function-variable function" style="display:inline-block">_looper</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _loopAsync </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _loop</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">do</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token comment" style="display:inline-block">// 判断返回是不是promise</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">!</span><span class="token plain" style="display:inline-block">_promise2 </span><span class="token operator" style="display:inline-block">||</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">!</span><span class="token plain" style="display:inline-block">_promise2</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Error</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token string" style="display:inline-block">&quot;Tap function (tapPromise) did not return promise (returned &quot;</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            _promise2 </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token string" style="display:inline-block">&quot;)&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      _promise2</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result2 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_loopAsync</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_looper</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">!</span><span class="token plain" style="display:inline-block">_loop</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token comment" style="display:inline-block">// ... reject 处理</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      _promise1</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result1 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_loopAsync</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_looper</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token function" style="display:inline-block">_next1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token comment" style="display:inline-block">// ... reject 处理</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    _promise0</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result0 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          _loop </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_loopAsync</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_looper</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token function" style="display:inline-block">_next0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token comment" style="display:inline-block">// ... reject 处理</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">while</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_loop</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _loopAsync </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token function" style="display:inline-block">_looper</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><h2 id="asyncserieswaterfallhook" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#asyncserieswaterfallhook"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>AsyncSeriesWaterfallHook</h2><p class="P_P__ZiYJk p-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesWaterfallHook.js?L34" class="A_A__VTs6i a-tag">AsyncSeriesWaterfallHook</a>会对每次执行异步函数的结果当成下一个回调函数的入参（<code>callAsync</code>/<code>promise</code>的入参 ），如果返回值是 <code>undefined</code>，使用上一个参数。</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">AsyncSeriesWaterfallHook</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;tapable&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 简单来说就是实例化 Hooks 类</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 接收一个可选参数，参数是一个参数名的字符串数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这组参数和注册回调函数的参数有关，</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> hook </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">AsyncSeriesWaterfallHook</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">[</span><span class="token string" style="display:inline-block">&quot;arg1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg3&quot;</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注册</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第一个入参为注册名</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第二个为注册回调方法，参数的形参个数和`AsyncSeriesWaterfallHook`的入参的数组有关系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> callback</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1-result&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> </span><span class="token comment" style="display:inline-block">// 返回值作为fn2的第一个入参</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> callback</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行顺序则是根据这个实例类型来决定的</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;a&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;b&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;c&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行结果</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn0 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn1 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn2 fn1-result b c</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>tapAsync</code> 和 <code>callAsync</code>的组合同理</p><p class="P_P__ZiYJk p-tag"><code>promise</code> 由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncSeriesWaterfallHook.js?L10:1" class="A_A__VTs6i a-tag">AsyncSeriesWaterfallHookCodeFactory</a>的<code>content</code>实现, 更深层次来说应该是由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1" class="A_A__VTs6i a-tag">HookCodeFactory</a>的<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L276" class="A_A__VTs6i a-tag">callTapsSeries</a>实现。 结果如下：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _context</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _x </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">_x</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn3 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">3</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult3 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise3 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn3</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">!</span><span class="token plain" style="display:inline-block">_promise3 </span><span class="token operator" style="display:inline-block">||</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">!</span><span class="token plain" style="display:inline-block">_promise3</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block">// 判断返回是不是promise</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Error</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token string" style="display:inline-block">&quot;Tap function (tapPromise) did not return promise (returned &quot;</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        _promise3 </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token string" style="display:inline-block">&quot;)&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _promise3</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      _hasResult3 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result3 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        arg1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _result3</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _promise2</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result2 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      arg1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _result2</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">_next2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_next0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _promise1</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result1 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        arg1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _result1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">_next1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">_promise0</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result0 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      arg1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _result0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">_next0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><h2 id="asyncparallelhook" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#asyncparallelhook"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>AsyncParallelHook</h2><p class="P_P__ZiYJk p-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncParallelHook.js?L26:1" class="A_A__VTs6i a-tag">AsyncParallelHook</a>并行执行, 不关心回调函数的返回值。</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">AsyncParallelHook</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;tapable&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 简单来说就是实例化 Hooks 类</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 接收一个可选参数，参数是一个参数名的字符串数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这组参数和注册回调函数的参数有关，</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 并行执行 不关心回调函数的返回值。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> hook </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">AsyncParallelHook</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">[</span><span class="token string" style="display:inline-block">&quot;arg1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg3&quot;</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注册</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第一个入参为注册名</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第二个为注册回调方法，参数的形参个数和`AsyncParallelHook`的入参的数组有关系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1-result&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">500</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行顺序则是根据这个实例类型来决定的</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;a&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;b&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;c&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行结果</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn2 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn0 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn1 a b c</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>tapAsync</code> 和 <code>callAsync</code>的组合同理</p><p class="P_P__ZiYJk p-tag"><code>promise</code> 由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncParallelHook.js?L10:1" class="A_A__VTs6i a-tag">AsyncParallelHookCodeFactory</a>的<code>content</code>实现, 更深层次来说应该是由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L7:1" class="A_A__VTs6i a-tag">HookCodeFactory</a>的<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/HookCodeFactory.js?L376:2" class="A_A__VTs6i a-tag">callTapsParallel</a>实现。 结果如下：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _context</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _x </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">_x</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword control-flow" style="display:inline-block">do</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _counter </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">3</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> </span><span class="token function-variable function" style="display:inline-block">_done</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&lt;=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">break</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 判断返回是不是promise</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">!</span><span class="token plain" style="display:inline-block">_promise0 </span><span class="token operator" style="display:inline-block">||</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">!</span><span class="token plain" style="display:inline-block">_promise0</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Error</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token string" style="display:inline-block">&quot;Tap function (tapPromise) did not return promise (returned &quot;</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        _promise0 </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token string" style="display:inline-block">&quot;)&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _promise0</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">--</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_err0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_hasResult0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> _err0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> _err0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        _counter </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&lt;=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">break</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _promise1</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">--</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_err1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_hasResult1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> _err1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> _err1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        _counter </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&lt;=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">break</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _promise2</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">--</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_err2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_hasResult2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> _err2</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> _err2</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        _counter </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">while</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><h2 id="asyncparallelbailhook" class="Heading_H2__gi2ap h2-tag"><a href="/blog/webpack/tapable#asyncparallelbailhook"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>AsyncParallelBailHook</h2><p class="P_P__ZiYJk p-tag"><a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncParallelBailHook.js?L74:1" class="A_A__VTs6i a-tag">AsyncParallelBailHook</a> 只要回调函数的返回值不为 <code>undefined</code>, 就会忽略后面的回调函数执行, 直接跳跃到 <code>callAsync</code> 等触发函数绑定的回调函数, 然后执行这个被绑定的回调函数。</p><p class="P_P__ZiYJk p-tag">使用和原理与 SyncBailHook 相似</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">AsyncParallelBailHook</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;tabable&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 简单来说就是实例化 Hooks 类</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 接收一个可选参数，参数是一个参数名的字符串数组</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 这组参数和注册回调函数的参数有关，</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 并行执行 不关心回调函数的返回值。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">const</span><span class="token plain" style="display:inline-block"> hook </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">AsyncParallelBailHook</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">[</span><span class="token string" style="display:inline-block">&quot;arg1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;arg3&quot;</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 注册</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第一个入参为注册名</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 第二个为注册回调方法，参数的形参个数和`AsyncParallelBailHook`的入参的数组有关系</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn0&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn1-result&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1000</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tapPromise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">arg1</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg2</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">resolve</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> reject</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token function" style="display:inline-block">setTimeout</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token arrow operator" style="display:inline-block">=&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token console class-name" style="display:inline-block">console</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">log</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;fn2&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token function" style="display:inline-block">resolve</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">500</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行顺序则是根据这个实例类型来决定的</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">hook</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">promise</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;a&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;b&quot;</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;c&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 执行结果</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn2 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn0 a b c</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// fn1 a b c</span></div></div></pre></div><p class="P_P__ZiYJk p-tag"><code>tapAsync</code> 和 <code>callAsync</code>的组合同理</p><p class="P_P__ZiYJk p-tag"><code>promise</code> 由<a href="https://sourcegraph.com/github.com/webpack/tapable/-/blob/lib/AsyncParallelBailHook.js?L10:1" class="A_A__VTs6i a-tag">AsyncParallelBailHookCodeFactory</a>的<code>content</code>实现。 结果如下：</p><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _context</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _x </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">_x</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _results </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Array</span><span class="token punctuation" style="display:inline-block">(</span><span class="token number" style="display:inline-block">3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> </span><span class="token function-variable function" style="display:inline-block">_checkDone</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">for</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> i </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> i </span><span class="token operator" style="display:inline-block">&lt;</span><span class="token plain" style="display:inline-block"> _results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"> i</span><span class="token operator" style="display:inline-block">++</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> item </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _results</span><span class="token punctuation" style="display:inline-block">[</span><span class="token plain" style="display:inline-block">i</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">item </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">item</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">result</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> item</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">result</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">item</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">error</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> item</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">error</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword control-flow" style="display:inline-block">do</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _counter </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">3</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> </span><span class="token function-variable function" style="display:inline-block">_done</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&lt;=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">break</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn0</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 判断返回是不是promise</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">!</span><span class="token plain" style="display:inline-block">_promise0 </span><span class="token operator" style="display:inline-block">||</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">!</span><span class="token plain" style="display:inline-block">_promise0</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Error</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token string" style="display:inline-block">&quot;Tap function (tapPromise) did not return promise (returned &quot;</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        _promise0 </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token string" style="display:inline-block">&quot;)&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  _promise0</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      _hasResult0 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token number" style="display:inline-block">0</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&lt;</span><span class="token plain" style="display:inline-block"> _results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&amp;&amp;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result0 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&amp;&amp;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token literal-property property" style="display:inline-block">result</span><span class="token operator" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"> _result0 </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token function" style="display:inline-block">_checkDone</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          _counter </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">--</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_err0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_hasResult0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> _err0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token number" style="display:inline-block">0</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&lt;</span><span class="token plain" style="display:inline-block"> _results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&amp;&amp;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">]</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token literal-property property" style="display:inline-block">error</span><span class="token operator" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"> _err0 </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token function" style="display:inline-block">_checkDone</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          _counter </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">--</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&lt;=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">break</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token number" style="display:inline-block">1</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&gt;=</span><span class="token plain" style="display:inline-block"> _results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">--</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn1</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    _promise1</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        _hasResult1 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token number" style="display:inline-block">1</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&lt;</span><span class="token plain" style="display:inline-block"> _results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&amp;&amp;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result1 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&amp;&amp;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token literal-property property" style="display:inline-block">result</span><span class="token operator" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"> _result1 </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token function" style="display:inline-block">_checkDone</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            _counter </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">--</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_err1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_hasResult1</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> _err1</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token number" style="display:inline-block">1</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&lt;</span><span class="token plain" style="display:inline-block"> _results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&amp;&amp;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">1</span><span class="token punctuation" style="display:inline-block">]</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token literal-property property" style="display:inline-block">error</span><span class="token operator" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"> _err1 </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token function" style="display:inline-block">_checkDone</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            _counter </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">--</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&lt;=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">break</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token number" style="display:inline-block">2</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&gt;=</span><span class="token plain" style="display:inline-block"> _results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">--</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _fn2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> _x</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> _promise2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_fn2</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">arg1</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg2</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> arg3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block">// ...</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    _promise2</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">then</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_result2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        _hasResult2 </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token boolean" style="display:inline-block">true</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token number" style="display:inline-block">2</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&lt;</span><span class="token plain" style="display:inline-block"> _results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&amp;&amp;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_result2 </span><span class="token operator" style="display:inline-block">!==</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword nil" style="display:inline-block">undefined</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&amp;&amp;</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token literal-property property" style="display:inline-block">result</span><span class="token operator" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"> _result2 </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token function" style="display:inline-block">_checkDone</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            _counter </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">--</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">_err2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_hasResult2</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> _err2</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">&gt;</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token number" style="display:inline-block">2</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&lt;</span><span class="token plain" style="display:inline-block"> _results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">&amp;&amp;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">length</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">3</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">_results</span><span class="token punctuation" style="display:inline-block">[</span><span class="token number" style="display:inline-block">2</span><span class="token punctuation" style="display:inline-block">]</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"> </span><span class="token literal-property property" style="display:inline-block">error</span><span class="token operator" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"> _err2 </span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token function" style="display:inline-block">_checkDone</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            _counter </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">else</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">            </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token operator" style="display:inline-block">--</span><span class="token plain" style="display:inline-block">_counter </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token number" style="display:inline-block">0</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">_done</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">          </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword control-flow" style="display:inline-block">while</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token boolean" style="display:inline-block">false</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div><p class="P_P__ZiYJk p-tag">参考</p><p class="P_P__ZiYJk p-tag"><a href="https://github.com/webpack/tapable" class="A_A__VTs6i a-tag">tapable</a></p><p class="P_P__ZiYJk p-tag"><a href="https://www.cnblogs.com/dennisj/p/14606902.html" class="A_A__VTs6i a-tag">webpack 核心模块 tapable 源码解析</a></p></article></div></div><footer class="Layout_footer__qU2TQ"><span style="margin-right:20px">I&#x27;m here </span><a href="https://github.com/freeshineit" target="_block">ShineShao</a><a href="https://github.com/freeshineit/freeshineit.github.io/issues" target="_blank" style="margin-left:20px">issues</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/webpack/tapable","query":{},"buildId":"tB7W_VdXUNRMG6ghQl1sJ","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script><script src="/static/js/heading.js"></script></body></html>