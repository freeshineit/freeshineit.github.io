<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="format-detection" content="telephone=no, email=no"/><title>Gulp 源码分析 (ShineShao)</title><meta name="description" content=" ShineShao 博客"/><meta name="keywords" content="ShineShao freeshineit Next.js Blog "/><meta name="next-head-count" content="8"/><link rel="shortcut icon" href="https://www.nextjs.cn/static/favicon/favicon.ico"/><script>var _hmt = _hmt || [];(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?50c47ad58047f480726591cca679297b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="preload" href="/_next/static/css/b3c88d5a6ecf92b8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b3c88d5a6ecf92b8.css" data-n-g=""/><link rel="preload" href="/_next/static/css/a643c4831a34d54c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a643c4831a34d54c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-dc0e1a98ad447e36.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-d719a31ca00eb19c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4ef93aa4e983de77.js" defer=""></script><script src="/_next/static/chunks/pages/blog/gulp/gulp-bc42ecc76309aa5a.js" defer=""></script><script src="/_next/static/3E58dNm2s0c1Xlxl9O4EX/_buildManifest.js" defer=""></script><script src="/_next/static/3E58dNm2s0c1Xlxl9O4EX/_ssgManifest.js" defer=""></script></head><body class="custom_class"><div id="__next" data-reactroot=""><div class="Layout_layout__3EeJ7 main-mdx" style="width:100%"><header class="Layout_header__LFgCt"><div class="Layout_container__ZgHhB"><nav><ul><li><a href="/">Home</a></li><li><a href="/blog">Blog</a></li><li><a href="/readme">README</a></li></ul></nav><div class="Layout_right__74zxP"><div class="Layout_Theme__yuqHW">🌜</div><a href="https://github.com/freeshineit" target="_block"><img src="/static/images/ShineShao.jpg" alt="ShineShao" class="ShineShao_ShineShao__X1C7d" style="width:34px;height:34px;border-radius:50%"/></a></div></div></header><div class="Layout_main__Obm0h" style="margin:0 auto"><div class="Cover_top__ZrW3_"><div class="Cover_coverWrapper__ORBLm"><div class="Cover_cover__946TB" style="background-image:url(/static/images/gulp.png)"></div><div class="Cover_coverBg__kRvQ4"></div><div class="Cover_dateWrapper__LkZQ2"><span class="Cover_date__EoZZG"><span class="Cover_dateDay__h46lo">28</span><span class="Cover_dateMonth__ygp2w">Nov</span><span class="Cover_dateMonth__ygp2w">2022</span></span><h1>Gulp 源码分析</h1></div></div></div><div class="Content_content__JCitR"><article><h2 id="gulp" class="Heading_H2__gi2ap h2-tag"><a href="/blog/gulp/gulp#gulp"><svg class="icon" height="1em" width="1em" viewBox="0 0 16 16" aria-hidden="true" fill="currentcolor"><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"></path></svg></a>Gulp</h2><div class="Pre_Pre__ws6ja pre-tag"><pre class="Code_pre__NnkMv pre-tag prism-code language-js " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__eSOJu">js</span><span class="Code_languageCopy__8SX5E"><svg viewBox="0 0 1024 1024" version="1.1" width="1em" height="1em" fill="currentColor"><path d="M768 682.666667V170.666667a85.333333 85.333333 0 0 0-85.333333-85.333334H170.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v512a85.333333 85.333333 0 0 0 85.333334 85.333333h512a85.333333 85.333333 0 0 0 85.333333-85.333333zM170.666667 170.666667h512v512H170.666667z m682.666666 85.333333v512a85.333333 85.333333 0 0 1-85.333333 85.333333H256a85.333333 85.333333 0 0 0 85.333333 85.333334h426.666667a170.666667 170.666667 0 0 0 170.666667-170.666667V341.333333a85.333333 85.333333 0 0 0-85.333334-85.333333z"></path></svg></span><div><div class="token-line"><span class="token string" style="display:inline-block">&quot;use strict&quot;</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> util </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;util&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// https://www.npmjs.com/package/undertaker</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// undertaker类提供了task，series，parallel，get，set，tree和registry方法</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// undertaker类继承于node核心类eventemitter</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">Undertaker</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;undertaker&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// https://www.npmjs.com/package/vinyl-fs</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// vinyl是vitual file formate虚拟文件格式，用于描述一个文件。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 它有两个主要的属性，path属性和contents属性。每一个Vinyl实例代表一个独立的文件、目录或者symlink符号连接。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> vfs </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;vinyl-fs&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// https://www.npmjs.com/package/glob-watcher</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 观察globs并在更改时执行一个函数，并使用智能默认值取消绑定和排队。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> watch </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">require</span><span class="token punctuation" style="display:inline-block">(</span><span class="token string" style="display:inline-block">&quot;glob-watcher&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token function maybe-class-name" style="display:inline-block">Gulp</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 改变Undertaker的this 指向，指向Gulp</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token maybe-class-name" style="display:inline-block">Undertaker</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">call</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// Bind the functions for destructuring</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">watch</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">watch</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">bind</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 任务。 由undertaker类提供</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">task</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">task</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">bind</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 任务顺序依次执行。 由undertaker类提供</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">series</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">series</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">bind</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 将任务功能或组合操作组合成并行执行的较大操作。 由undertaker类提供</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">parallel</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">parallel</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">bind</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// https://www.gulpjs.com.cn/docs/api/registry/</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 允许将自定义的注册表插入到任务系统中，以期提供共享任务或增强功能。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 由undertaker类提供</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">registry</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">registry</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">bind</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 获取当前任务依赖关系树。 由undertaker类提供</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">tree</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">tree</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">bind</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 由undertaker类提供</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">lastRun</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">lastRun</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">bind</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 创建一个流，用于从文件系统读取 Vinyl 对象。由 vinyl-fs 提供</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">src</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">src</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">bind</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 创建一个用于将 Vinyl 对象写入到文件系统的流。由 vinyl-fs 提供</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">dest</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">dest</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">bind</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 符号链接。 由 vinyl-fs 提供</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">symlink</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">symlink</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">bind</span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// https://nodejs.org/docs/latest/api/util.html#utilinheritsconstructor-superconstructor</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 继承</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 已经不建议使用了， 最好使用es6的继承方式  extends</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">util</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">inherits</span><span class="token punctuation" style="display:inline-block">(</span><span class="token maybe-class-name" style="display:inline-block">Gulp</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">Undertaker</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// https://www.npmjs.com/package/vinyl-fs#options</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// vfs.src(globs[, options])</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token class-name" style="display:inline-block">Gulp</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">prototype</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">src</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> vfs</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">src</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// https://www.npmjs.com/package/vinyl-fs#destfolder-options</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// vfs.dest(folder[, options])</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 将文件夹路径字符串或函数作为第一个参数，将选项对象作为第二个参数。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 如果给定一个函数，它将与每个vinyl File对象一起调用，并且必须返回文件夹路径。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 返回一个流，该流接受vinyl File对象，将它们写入指定文件夹/cwd中的磁盘，并将它们传递到下游，这样您就可以继续使用管道。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 一旦文件写入磁盘后，将尝试确定vinyl File对象的`stat.mode`、`stat.mtime`和`stat.atime`是否与文件系统上的文件不同。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 如果它们不同，并且正在运行的进程拥有该文件，则会更新相应的文件系统元数据。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 如果它们没有差异或进程不拥有文件，则会自动跳过尝试。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 如果文件具有指定目标路径的`symlink`属性，则将创建`symlink`。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token class-name" style="display:inline-block">Gulp</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">prototype</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">dest</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> vfs</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">dest</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// https://www.npmjs.com/package/vinyl-fs#symlinkfolder-options</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// vfs.symlink(folder[, options])</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 将文件夹路径字符串或函数作为第一个参数，将选项对象作为第二个参数。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 如果给定一个函数，它将与每个vinyl File对象一起调用，并且必须返回文件夹路径。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 返回一个流，该流接受vinyl File对象，在指定的文件夹/cwd处创建一个`symlink`，并将其传递到下游，这样您就可以继续使用管道传递这些对象。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token class-name" style="display:inline-block">Gulp</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">prototype</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">symlink</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> vfs</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">symlink</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// 在 `glob-watcher` 前做校验和兼容</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">//</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token class-name" style="display:inline-block">Gulp</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">prototype</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method-variable function-variable method function property-access" style="display:inline-block">watch</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">function</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token parameter" style="display:inline-block">glob</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> opt</span><span class="token parameter punctuation" style="display:inline-block">,</span><span class="token parameter" style="display:inline-block"> task</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">typeof</span><span class="token plain" style="display:inline-block"> opt </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;string&quot;</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">||</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword" style="display:inline-block">typeof</span><span class="token plain" style="display:inline-block"> task </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;string&quot;</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">||</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token known-class-name class-name" style="display:inline-block">Array</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">isArray</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">opt</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">||</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token known-class-name class-name" style="display:inline-block">Array</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">isArray</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">task</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token keyword control-flow" style="display:inline-block">throw</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Error</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token string" style="display:inline-block">&quot;watching &quot;</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        glob </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token string" style="display:inline-block">&quot;: watch task has to be &quot;</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token string" style="display:inline-block">&quot;a function (optionally generated by using gulp.parallel &quot;</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">+</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token string" style="display:inline-block">&quot;or gulp.series)&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">typeof</span><span class="token plain" style="display:inline-block"> opt </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;function&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    task </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> opt</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    opt </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block">  opt </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> opt </span><span class="token operator" style="display:inline-block">||</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> fn</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">if</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">(</span><span class="token keyword" style="display:inline-block">typeof</span><span class="token plain" style="display:inline-block"> task </span><span class="token operator" style="display:inline-block">===</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;function&quot;</span><span class="token punctuation" style="display:inline-block">)</span><span class="token plain" style="display:inline-block"> </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    fn </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">this</span><span class="token punctuation" style="display:inline-block">.</span><span class="token method function property-access" style="display:inline-block">parallel</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">task</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// watch() 方法时通过 `events` 参数进行指定。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 可用的事件有 &#x27;add&#x27;、&#x27;addDir&#x27;、&#x27;change&#x27;、&#x27;unlink&#x27;、&#x27;unlinkDir&#x27;、&#x27;ready&#x27;、&#x27;error&#x27;。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block">// 此外，还有一个 &#x27;all&#x27; 事件，它表示除 &#x27;ready&#x27; 和 &#x27;error&#x27; 之外的所有事件。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token keyword control-flow" style="display:inline-block">return</span><span class="token plain" style="display:inline-block"> </span><span class="token function" style="display:inline-block">watch</span><span class="token punctuation" style="display:inline-block">(</span><span class="token plain" style="display:inline-block">glob</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> opt</span><span class="token punctuation" style="display:inline-block">,</span><span class="token plain" style="display:inline-block"> fn</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token punctuation" style="display:inline-block">}</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// Let people use this class from our instance</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token class-name" style="display:inline-block">Gulp</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">prototype</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access maybe-class-name" style="display:inline-block">Gulp</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token maybe-class-name" style="display:inline-block">Gulp</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token comment" style="display:inline-block">// Gulp 实例</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token keyword" style="display:inline-block">var</span><span class="token plain" style="display:inline-block"> inst </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> </span><span class="token keyword" style="display:inline-block">new</span><span class="token plain" style="display:inline-block"> </span><span class="token class-name" style="display:inline-block">Gulp</span><span class="token punctuation" style="display:inline-block">(</span><span class="token punctuation" style="display:inline-block">)</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">module</span><span class="token punctuation" style="display:inline-block">.</span><span class="token property-access" style="display:inline-block">exports</span><span class="token plain" style="display:inline-block"> </span><span class="token operator" style="display:inline-block">=</span><span class="token plain" style="display:inline-block"> inst</span><span class="token punctuation" style="display:inline-block">;</span></div></div></pre></div></article></div></div><footer class="Layout_footer__qU2TQ"><span style="margin-right:20px">I&#x27;m here </span><a href="https://github.com/freeshineit" target="_block">ShineShao</a><a href="https://github.com/freeshineit/freeshineit.github.io/issues" target="_blank" style="margin-left:20px">issues</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/gulp/gulp","query":{},"buildId":"3E58dNm2s0c1Xlxl9O4EX","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script><script src="/static/js/heading.js"></script></body></html>