<!DOCTYPE html><html><head><link rel="shortcut icon" href="https://www.nextjs.cn/static/favicon/favicon.ico"/><script>var _hmt = _hmt || [];(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?50c47ad58047f480726591cca679297b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="format-detection" content="telephone=no, email=no"/><title>docker nginx 部署React项目 (ShineShao)</title><meta name="description" content="使用docker nginx 容器部署create-react-app 创建的React项目和代理接口"/><meta name="keywords" content="ShineShao freeshineit Next.js Blog "/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/ea62958e264ac68e7a09.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ea62958e264ac68e7a09.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-10105bb2d855dad6dba6.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-c5c678ba45d45bf9d8f5.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d5bae952006ea427deeb.js" defer=""></script><script src="/_next/static/chunks/pages/blog/react/nginx_deploy-617fd30aa61c4e4b0982.js" defer=""></script><script src="/_next/static/Ydt9YVWfV84fG8f3-uBos/_buildManifest.js" defer=""></script><script src="/_next/static/Ydt9YVWfV84fG8f3-uBos/_ssgManifest.js" defer=""></script></head><body class="custom_class"><div id="__next"><div class="Layout_layout__3guix main-mdx" style="width:100%"><header class="Layout_header__1Ex29"><div class="Layout_container__2QLYW"><nav><ul><li><a href="/">Home</a></li><li><a href="/blog">Blog</a></li><li><a href="/readme">README</a></li></ul></nav><div class="Layout_right__2NMHu"><div class="Layout_Theme__3HBe3">🌜</div><a href="https://github.com/freeshineit" target="_block"><img src="/static/images/ShineShao.jpg" alt="ShineShao" class="ShineShao_ShineShao__3y7j0" style="width:34px;height:34px;border-radius:50%"/></a></div></div></header><div class="Layout_main__3m1yK" style="margin:0 auto"><div class="mdx-box"><article><h2 id="docker-nginx" class="Heading_H2__2MwMw h2-tag"><a aria-hidden="true" tabindex="-1" href="#docker-nginx" class="A_A__LqrNw a-tag"><span class="icon icon-link"></span></a>docker nginx</h2><ol class="List_Ol__3Jmpf ol-tag"><li class="li-tag">在项目根目录下新建 <code>docker-compose.yml</code>文件</li></ol><div class="Pre_Pre__269fU pre-tag"><pre class="Code_pre__r85Dc pre-tag prism-code language-yml " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__1zO4b">yml</span><div class="token-line"><span class="token key atrule" style="display:inline-block">version</span><span class="token punctuation" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;2&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span><span class="token key atrule" style="display:inline-block">services</span><span class="token punctuation" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token comment" style="display:inline-block"># 服务名称</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">  </span><span class="token key atrule" style="display:inline-block">nginx</span><span class="token punctuation" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block"># 镜像:版本</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token key atrule" style="display:inline-block">image</span><span class="token punctuation" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"> nginx</span><span class="token punctuation" style="display:inline-block">:</span><span class="token plain" style="display:inline-block">latest</span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block"># 映射容器80端口到本地80端口</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token key atrule" style="display:inline-block">ports</span><span class="token punctuation" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">-</span><span class="token plain" style="display:inline-block"> </span><span class="token string" style="display:inline-block">&quot;80:80&quot;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block"># 数据卷 映射本地文件到容器</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block"># 这个更新起来特别香</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token key atrule" style="display:inline-block">volumes</span><span class="token punctuation" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token comment" style="display:inline-block"># 映射nginx.conf文件到容器的/etc/nginx/conf.d目录并覆盖default.conf文件</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">-</span><span class="token plain" style="display:inline-block"> ./nginx.conf</span><span class="token punctuation" style="display:inline-block">:</span><span class="token plain" style="display:inline-block">/etc/nginx/conf.d/default.conf</span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token comment" style="display:inline-block"># 映射build文件夹到容器的/usr/share/nginx/html文件夹</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">      </span><span class="token punctuation" style="display:inline-block">-</span><span class="token plain" style="display:inline-block"> ./build</span><span class="token punctuation" style="display:inline-block">:</span><span class="token plain" style="display:inline-block">/usr/share/nginx/html</span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block"># 覆盖容器启动后默认执行的命令。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token key atrule" style="display:inline-block">command</span><span class="token punctuation" style="display:inline-block">:</span><span class="token plain" style="display:inline-block"> /bin/bash </span><span class="token punctuation" style="display:inline-block">-</span><span class="token plain" style="display:inline-block">c &quot;nginx </span><span class="token punctuation" style="display:inline-block">-</span><span class="token plain" style="display:inline-block">g &#x27;daemon off;&#x27;&quot;</span></div></pre></div><p class="P_P__2prMq p-tag">挂载 nginx 配置</p><div class="Pre_Pre__269fU pre-tag"><pre class="Code_pre__r85Dc pre-tag prism-code language-bash " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__1zO4b">bash</span><div class="token-line"><span class="token plain" style="display:inline-block">location / </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        root   /usr/share/nginx/html</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        index  index.html index.htm</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token comment" style="display:inline-block"># 其作用是按顺序检查文件是否存在，返回第一个找到的文件或文件夹（结尾加斜线表示为文件夹），如果所有的文件或文件夹都找不到，会进行一个内部重定向到最后一个参数。</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        try_files </span><span class="token variable" style="display:inline-block">$uri</span><span class="token plain" style="display:inline-block"> /index.html</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token comment" style="display:inline-block"># 接口代理</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    location ^~ /api/ </span><span class="token punctuation" style="display:inline-block">{</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token comment" style="display:inline-block"># proxy_set_header X-Forwarded-Host $host;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token comment" style="display:inline-block"># proxy_set_header X-Forwarded-Server $host;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        </span><span class="token comment" style="display:inline-block"># proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">        proxy_pass http://xxx.xxxxx.xxxx</span><span class="token punctuation" style="display:inline-block">;</span><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain" style="display:inline-block">    </span><span class="token punctuation" style="display:inline-block">}</span></div></pre></div><ol start="2" class="List_Ol__3Jmpf ol-tag"><li class="li-tag">编译 react 项目</li></ol><div class="Pre_Pre__269fU pre-tag"><pre class="Code_pre__r85Dc pre-tag prism-code language-bash " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__1zO4b">bash</span><div class="token-line"><span class="token function" style="display:inline-block">yarn</span><span class="token plain" style="display:inline-block"> run build</span></div></pre></div><ol start="3" class="List_Ol__3Jmpf ol-tag"><li class="li-tag">生成容器并部署</li></ol><div class="Pre_Pre__269fU pre-tag"><pre class="Code_pre__r85Dc pre-tag prism-code language-bash " style="background-color:#2a2734;color:#9a86fd;overflow:scroll;margin-top:20px;margin-bottom:20px;padding:16px"><span class="Code_language__1zO4b">bash</span><div class="token-line"><span class="token plain" style="display:inline-block">docker-compose up -d</span></div></pre></div><ol start="4" class="List_Ol__3Jmpf ol-tag"><li class="li-tag"><p class="P_P__2prMq p-tag">本地访问 <code>http://localhost/</code></p></li><li class="li-tag"><p class="P_P__2prMq p-tag">停止并删除容器 <code>docker-compose down</code></p></li></ol></article></div></div><footer class="Layout_footer__1xrEh"><span style="margin-right:20px">I&#x27;m here </span><a href="https://github.com/freeshineit" target="_block">ShineShao</a><a href="https://github.com/freeshineit/freeshineit.github.io/issues" target="_blank" style="margin-left:20px">issues</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/react/nginx_deploy","query":{},"buildId":"Ydt9YVWfV84fG8f3-uBos","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script><script src="/static/js/heading.js"></script></body></html>